<app-card>

  <div *ngIf="quotation.status=='paid' && thankyou==true">
    <h3>Thank you for your Order ! </h3>
    <p>Your order has been Placed and is being processed. You will receive an email with the details shortly.
      <!-- <br>
    <i class="ti-check"  style="color:green;font-weight:bold"></i> Rs. {{quotation.transaction.amount}} Paid Through {{quotation.transaction.payment_method}} <br>
    Transaction ID #{{quotation.transaction.id}} -->
    </p>
  </div>
  <hr>

  <h4 *ngIf="quotation.id"> <a href="javascript:void(0)" (click)="goBack()">
      <i class="cr-icon fa fa-arrow-left"></i>
    </a> Application #{{quotation.id}} : <span *ngIf="quotation.noc == 1">NOC </span> {{ quotation.status | uppercase}}
    <a *ngIf="quotation.status=='pending'" (click)="stopInterval(); getQuotation(quotation.id, quotation.uuid)" class="btn btn-primary btn-xl" style="color:white">
      <i class="cr-icon fa fa-refresh"></i>
  </a>
  

    <button *ngIf="quotation.invoice_no && quotation.noc == 0 && quotation.irn_no && quotation.irn_status != 'cancel' && authService.checkPermission(85)" style="margin-left:5px; float: right;" target=_blank class="btn btn-danger" (click)="prepareCancelnvoice()"> Cancel Invoice </button>
   
  </h4>
  <span style="color:red;" class="float-right" *ngIf="quotation.invoice_no && quotation.irn_status == 'cancel' "> This invoice already cancelled within 24 hour from  IRN generated </span>
  <span *ngIf="quotation.status=='paid'">
    <!--     <a *ngIf="quotation.status=='pending'" href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}" target=_blank class="btn btn-primary btn-xl"  >Pay Now</a>  -->
    <a *ngIf="quotation.status=='paid'" style="color:white" (click)="modalIssueLicenses.show()"
      class="btn btn-primary  ">Issue Licenses</a>

    <!--
<a *ngIf="quotation.status=='paid'" class="btn btn-primary btn-sm" target=_blank href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}">Quotation</a>
-->
    <a *ngIf="quotation.status=='paid'" style="margin-left:5px"
      href="{{commonService.apiUrl}}/pg/?invoice=2&id={{quotation.id}}&uuid={{quotation.uuid}}" target=_blank class="btn btn-primary  ">Proforma
      Invoice <i class="cr-icon fa fa-external-link"></i></a>

    <a *ngIf="quotation.status=='paid' && quotation.noc == 0" style="margin-left:5px"
      href="{{commonService.apiUrl}}/pg/?invoice=1&id={{quotation.id}}&uuid={{quotation.uuid}}" target=_blank class="btn btn-primary  "> Tax
      Invoice <i class="cr-icon fa fa-external-link"></i></a>

    <a *ngIf="(quotation.status == 'paid' && authService.checkPermission(80)) && quotation?.license_issued == 1 && quotation?.issuedlcjson!=''"
      style="color:white; margin-left:5px" (click)="confirmrecreateLicenses();" class="btn btn-primary">Reset
      Licenses</a>

    <!-- <button *ngIf="quotation.status=='paid' && quotation.noc == 0 && authService.checkPermission(85)" style="margin-left:5px; float: right;" target=_blank class="btn btn-danger" (click)="prepareCancelnvoice()"> Cancel Invoice </button> -->
    <hr>
    <span *ngIf="selectedCustomer?.tan">
      <!-- <hr>  -->
      TDS {{quotation?.tds}}% Applied with TAN No.: {{selectedCustomer?.tan}} </span>
    <!-- persegst-->
    <span *ngIf="quotation?.multiinvoice">
      <hr>
      <span *ngFor="let item of quotation?.multiinvoice ; let i = index">
        #{{i+1}} : GST : <b>{{item.gst}}</b> - <b>Rs. {{item.cartamountwithdiscount}}</b> <br>({{item.totallicenses}}
        Licenses) | <span> <a target=_blank
            href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}&invoice=1&mi={{i+1}}&uuid={{quotation.uuid}}"><span
              *ngIf="quotation.invoice_no">Tax Invoice</span> Download</a></span><br>
        <hr>
      </span>
      <hr>
    </span>
    <!-- endofpersegst-->
  </span>
  
  <span *ngIf = "(quotation.status=='paid'|| quotation.status=='pending') && quotation?.extend_lic">
    <p *ngIf="quotation?.extend_lic.id == quotation?.id ">This is Extended Proforma Invoice against Current Lead ID : {{quotation.extend_lic.lead_id}} </p>
    <p *ngIf="quotation?.extend_lic.id != quotation?.id " >This is Extended Proforma Invoice against #LeadID: {{quotation.extend_lic.lead_id}} And  PI's ID #{{quotation.extend_lic.id}} </p>
    <a *ngIf = "quotation?.extend_lic && quotation?.extend_lic.id != quotation?.id && quotation?.extend_lic.status == 'paid' && quotation?.extend_lic.license_issued == 1 && quotation?.extend_lic.noc ==1 " style="margin-left:5px"
      href="{{commonService.apiUrl}}/pg/?id={{quotation.extend_lic.id}}&invoice=2&showlicense=1&uuid={{quotation?.extend_lic?.uuid}}" target=_blank class="btn btn-primary  "> Extended
      Licenses <i class="cr-icon fa fa-external-link"></i></a>

    <a *ngIf = "quotation?.extend_lic && quotation?.extend_lic.id != quotation?.id && quotation?.extend_lic.license_issued == 0 && quotation?.extend_lic.noc ==1"  style="margin-left:5px"
      [routerLink]="['/quotation/view/'+quotation.extend_lic.id+'/'+quotation?.extend_lic.uuid]" target=_blank class="btn btn-primary  "> Go to Extended
      PI  <i class="cr-icon fa fa-external-link"></i></a>

    <hr>
    </span>


  <div class="preloader3 loader-block" *ngIf="loading">
    <div class="circ1"></div>
    <div class="circ2"></div>
    <div class="circ3"></div>
    <div class="circ4"></div>
  </div>
  
    <!-- ################################################################## new stepper code start #################################################################### -->
    <mat-stepper #stepper>
      <mat-step  errorMessage="Name is required.">
        
          <!-- <ng-template matStepLabel>CUSTOMER INFO</ng-template> -->
          <!-- <mat-form-field>
            <mat-label>Name</mat-label>
            <input matInput placeholder="Last name, First name" formControlName="firstCtrl" required>
          </mat-form-field>
          <div class="centered-content">
            <h4>Customer Info</h4>
          </div> -->
          <!-- ==================================================================== customer info first step ========================================== -->
          <div>
            <div class="centered-content">
              <h4>Customer Info</h4>
            </div>
    
            <hr>
            <div>
              <div class="row">
                <div class="col-sm-12">
                  <hr>
                  <h4 class="sub-title" style="padding-bottom: 2px">Enter Lead ID :  
                    <!-- (For PALM Sync) -->
                    <!-- <input
                      class="form-control" type=number min=0 step=1 name=lead_id [(ngModel)]="quotation.lead_id"
                      (change)="getLeadstatusquestions(0,quotation.lead_id,1)"><br> -->
                      <ng-select bindLabel="id" [items]="leads" [loading]="leadLoading" [typeahead]="leadTypeahead"
                      placeholder="Select Lead" (change)="setLeadInfo()"
                      [(ngModel)]="selectedLead"
                      (clear)="selectedLead={};selectedCustomer={};selectedUser={};quotation.lead_id =0;">
                      <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
                        <div style="margin: 2px 0;" class="card">
                          <div class="card-body" style="padding: 5px">
                              <h5 class="card-title" style="font-size: 14px; font-weight: 400;">
                                  #{{item?.id}} : {{item?.cname}}
                              </h5>
                      
                              <h6 class="card-subtitle text-muted" style="margin-top: 0px;">
                                  <span *ngIf="item?.user">Lead Owner : {{item?.user?.name}}</span>
                              </h6>
                          </div>
                      </div>
                      
                      </ng-template>
        
                    </ng-select>
                    <!-- <small> <b>Note : You should enter Lead Id for Renewals , Otherwise New Lead ID will be created for
                        same.</b></small> -->
                        <small> <b>Note : You should enter Lead Id Mandatory</b></small>
                  </h4>
               
    
                </div>
    
                <div class="col-sm-12">
                  <hr>
                  <h4 class="sub-title" style="padding-bottom: 18px">Select Lead Owner :</h4>
                  <ng-select bindLabel="userdisplayname" [items]="users" [(ngModel)]="selectedUser" placeholder="Select Lead Owner" (change)="this.quotation.subregion =null; regionvalidation(); ">
                    <ng-template ng-option-tmp let-item="item">
                      <span *ngIf="item.active==0" style="color:red">{{ item.userdisplayname  }}</span>
                      <span *ngIf="item.active==1">{{ item.userdisplayname  }}</span>
                    </ng-template>
                  </ng-select>
                </div>
                <div *ngIf="selectedUser?.region_ids" class="col-sm-12">
                  <hr>
                  <h4 class="sub-title" style="padding-bottom: 18px">Select Region(New method) :</h4>
                  <ng-select bindLabel="displayname" [items]="selectedUser?.region_ids_info" [(ngModel)]="quotation.subregion" placeholder="Select Region" (change)="regionvalidation()">
                    <ng-template ng-option-tmp let-item="item">
                      <span>{{ item.displayname  }}</span>
                    </ng-template>
                  </ng-select>
                </div>
    
                <div  class="col-sm-12">
                  <hr>
                  <h4 class="sub-title">
                    Select Customer :
                     <!-- <label> <input type=radio name="lcustfilter" checked (change)="selectedCustomer.lcustfilter=0;selectedCustomer.action='update'"> Existing</label> &nbsp;&nbsp; <label  > 
                      <input  (change)="selectedCustomer.lcustfilter=1;selectedCustomer.action='addnew';selectedCustomer.id=-1;showC=1" type=radio name="lcustfilter"> New</label>  -->
                  </h4>
                  <!-- [hidden]="selectedCustomer?.lcustfilter==1" -->
                  <ng-select bindLabel="displayname" [items]="customers" [loading]="custLoading" [typeahead]="custTypeahead"
                    placeholder="Select Existing Customer"
                    (change)="tdspatch(selectedCustomer.tds);quotation.isPirChanged = 1;" [(ngModel)]="selectedCustomer"
                    (clear)="selectedCustomer={};">
                    <!-- (clear)="selectedCustomer={};selectedCustomer.tds=0;selectedCustomer.address_search='';"-->
                    <ng-template ng-option-tmp let-item="item" let-index="index" let-search="searchTerm">
    
                      <div style="margin: 2px 0;" class="card">
                        <div class="card-body" style="padding: 5px">
                            <h5 class="card-title" style="font-size: 14px; font-weight: 400;">
                                #{{item?.id}} : {{item?.name}} - {{item.city}}
                            </h5>
                    
                            <h6 class="card-subtitle text-muted" style="margin-top: 0px;">
                                <span *ngIf="item?.pan">PAN : {{item?.pan}}</span>
                                <span *ngIf="item?.gst">&nbsp;|&nbsp; GST : {{item?.gst}}</span>
                            </h6>
                            <!--  <p class="card-text">
                                 {{item?.address_line_1}},{{item.address_line_2}},{{item?.address_line_3}},<br> 
                                  ,{{item?.state}} ,{{item.pincode}} 
                                 </p> -->
                    
                        </div>
                    </div>
                    
                    </ng-template>
    
                  </ng-select>
                  <a style="color: purple" *ngIf="selectedCustomer?.id > 0 && showC==0" (click)="showC=1">Show Details</a>
                  <a style="color: purple"
                    *ngIf="showC==1 && selectedCustomer?.id > 0  && selectedCustomer?.action!='addnew' "
                    (click)="showC=0">Hide Details</a>
                  <span [hidden]="true"> TDS : <input (change)="checkIfTan($event)" style="width:50px" type=number min=0
                      [(ngModel)]="tds"> % </span>
    
                  <span [hidden]="selectedCustomer?.pan"><br> <br>
                    <h4 *ngIf="selectedCustomer?.action==='addnew'">Add New Customer</h4>
                              <h4 *ngIf="showC==1 && selectedCustomer?.id>0">Customer Information : <a [routerLink]="['/customer']" target=_blank>Manage Customers <i class="fa fa-external-link" aria-hidden="true"></i></a></h4>
    
    
    
                  </span>
    
                  <!-- Depreciated google search [(ngModel)]="selectedCustomer.address_search" -->
                  <span [hidden]="selectedCustomer?.action!='addnew'"> Search Address/Business on Google : <input
                      autocorrect="off" #search type="text" class="form-control " name="address_search"
                      placeholder="Search Address" required></span>
    
                  <!-- (selectedCustomer.id && selectedCustomer.pan.length > 2 ) || (!selectedCustomer.id && selectedCustomer.action !='addnew')-->
                  <div [hidden]="showC!=1" *ngIf="selectedCustomer?.id" class="avoid-clickss">
                    <h4 *ngIf="selectedCustomer?.id>0"><br>Customer Information : </h4>
                    <small>For Managing Customer Information , Please Check 'Customers' Tab</small>
    
                    <hr>
    
    
    
    
    
                    <div class="form-group row">
                      <div class="col-sm-6">
                        Customer Name : <span style="color:red">*</span>
                        <input disabled style="text-transform:uppercase" type="text" class="form-control " name="name"
                          placeholder="Enter Name" [(ngModel)]="selectedCustomer.name" required>
                      </div>
                      <!-- <div class="col-sm-6"> 
                     Customer Email :
                    <input type="email" (change)="selectedCustomer.contact_email=selectedCustomer.email" class="form-control " name="email" placeholder="Company Email" [(ngModel)]="selectedCustomer.email" required>
                   </div> -->
    
                      <div class="col-sm-6">
                        Franchise / Brand :
                        <input disabled type="text" class="form-control " name="franchise"
                          placeholder="Enter Franchise/Brand" [(ngModel)]="selectedCustomer.franchise">
    
                      </div>
                    </div>
    
                    <!-- <div class="form-group row">
                  <div class="col-sm-6">
                    Phone :
                      <input type="text" class="form-control " name="phone" placeholder="Enter Phone" [(ngModel)]="selectedCustomer.phone" required>
                   </div>
                   <div class="col-sm-6"> 
                     Mobile :
                    <input (change)="selectedCustomer.contact_no=selectedCustomer.mobile"  type="number" class="form-control " name="mobile" placeholder="Mobile" [(ngModel)]="selectedCustomer.mobile" required>
                   </div>
              </div> -->
    
    
    
    
                    <!--  Complete Address : 
              <textarea  [(ngModel)]="selectedCustomer.address" class="form-control " name="formatted_address" placeholder="Complete Address" >   </textarea>
      <hr>-->
                    <div class="form-group row">
                      <div class="col-sm-6">
                        <!--                <input  type="text" class="form-control " name="address" placeholder="Enter Address" [(ngModel)]="selectedCustomer.address" required> -->
                        Address Line 1 : <span style="color:red">*</span>
                        <input disabled type="text" class="form-control " name="address_line_1" placeholder="Address Line 1"
                          [(ngModel)]="selectedCustomer.address_line_1" required>
    
                      </div>
                      <div class="col-sm-6">
                      </div>
                    </div>
                    <div class="form-group row">
                      <div class="col-sm-6">
                        Address Line 2 : <span style="color:red">*</span>
                        <input disabled type="text" class="form-control " name="address_line_2" placeholder="Address Line 2"
                          [(ngModel)]="selectedCustomer.address_line_2" required>
                      </div>
    
                      <div class="col-sm-6">
                        Town / Locality : <span style="color:red">*</span>
                        <input disabled type="text" class="form-control " name="address_line_3" placeholder="Address Line 3"
                          [(ngModel)]="selectedCustomer.address_line_3" required>
                      </div>
    
    
    
                    </div>
    
    
                    <div class="form-group row">
    
                      <div class="col-sm-6" *ngIf=states><br>
                        State : <span style="color:red">*</span>
                        <!--  <input placeholder = "State" class="form-control  " disabled [(ngModel)]="selectedCustomer.state" name="state" required>
                -->
                        <ng-select disabled placeholder="Select State" name="state"
                          (change)="cities = [];selectedCustomer.city='';" required bindLabel="state" bindValue="state"
                          [items]="states" [(ngModel)]="selectedCustomer.state">
                        </ng-select>
                      </div>
    
    
                      <div class="col-sm-6"><br>
                        City : <span style="color:red">*</span>
                        <!-- <input type="text" id="autocomplete" class="form-control " name="city" autocorrect="off" placeholder="City" [(ngModel)]="selectedCustomer.city"   required>
                  -->
    
                        <ng-select disabled bindLabel="name" bindValue="name" [items]="cities" [loading]="cityLoading"
                          [typeahead]="custTypeaheadCity" placeholder="Search Existing City"
                          [(ngModel)]="selectedCustomer.city" required>
                        </ng-select>
    
                      </div>
    
                    </div>
    
                    <div class="form-group row">
                      <div class="col-sm-6">
                        Pincode : <span style="color:red">*</span>
                        <!-- (change)="getPincodeinfo()"-->
                        <input disabled type="number" class="form-control " name="pincode" placeholder="Search Pincode"
                          [(ngModel)]="selectedCustomer.pincode" required>
                      </div>
                      <div class="col-sm-6">
                        Country : <span style="color:red">*</span>
                        <input disabled placeholder="India" class="form-control " [(ngModel)]="selectedCustomer.country"
                          name="country" required>
    
                      </div>
                    </div>
                    <hr>
    
                    <div class="form-group row">
                      <div class="col-sm-6">
                        PAN :
                        <!-- (change)="field_validate($event,'pan',selectedCustomer.pan)" -->
                        <input disabled (change)="field_validate($event,'pan',selectedCustomer.pan)" type="text"
                          class="form-control " name="pan" placeholder="Enter PAN" [(ngModel)]="selectedCustomer.pan">
                        <br>
                        <!--
        TAN :
        <input type="text" class="form-control " name="tan" (change)="field_validate($event,'tan',selectedCustomer.tan)"  placeholder="TAN" [(ngModel)]="selectedCustomer.tan" required> -->
    
    
                      </div>
                      <div class="col-sm-6">
                        GST :
                        <input disabled type="text" class="form-control " name="gst"
                          (change)="field_validate($event ,'gst',selectedCustomer.gst)" placeholder="Enter GST"
                          [(ngModel)]="selectedCustomer.gst" required>
    
                        <br>
                        <!--    TDS (%) : <input class="form-control " (change)="checkIfTan($event)"  type=number min=0 [(ngModel)]="tds"> -->
    
                      </div>
                    </div>
    
                    <div class="form-group row">
                      <div class="col-sm-6">
                        SEZ Unit :
                        <ng-select disabled placeholder="Select SEZ Status" name=SEZ [(ngModel)]=selectedCustomer.sez
                          [items]="['NO','LUT','IGST']">
    
                        </ng-select>
                      </div>
                      <div class="col-sm-6">
                        Customer Additional information : 
                        <input  type="text" class="form-control " name="additional_info" placeholder="Enter Customer Additional information"
                        [(ngModel)]="selectedCustomer.additional_info"  >
                      </div>
                    </div>
    
                    <hr>
                    <h5 style="font-size: 14px;font-weight: 600;">Contact Person Information :</h5>
                    <hr>
                    <div class="form-group row">
    
                      <div class="col-sm-6">
                        Contact Person Name : <span style="color:red">*</span>
                        <input disabled type="text" class="form-control " name="contact_person" placeholder="Contact Person"
                          [(ngModel)]="selectedCustomer.contact_person" required (keyup)="qvalues ={};">
                        <br>
                        Contact Person Email : <span style="color:red">*</span>
                        <input disabled type="email" (change)="field_validate($event,'contact_email');qvalues ={};"
                          class="form-control " name="contact_email" placeholder="Contact Email"
                          [(ngModel)]="selectedCustomer.contact_email" required>
                      </div>
                      <div class="col-sm-6">
                        Contact Person Designation : <span style="color:red">*</span>
                        <input disabled type="text" class="form-control " name="contact_designation"
                          placeholder="Contact Person Designation" [(ngModel)]="selectedCustomer.contact_designation"
                          required (keyup)="qvalues ={};">
                        <br>
                        Contact Person Mobile : <span style="color:red">*</span>
                        <input disabled type="text" (change)="field_validate($event ,'mobile');" (keyup)="qvalues ={};"
                          class="form-control " name="contact_no" placeholder="Contact No"
                          [(ngModel)]="selectedCustomer.contact_no" required>
                      </div>
                    </div>
    
    
    
                    <br>
                    <!--<label>Save This Customer : <select  [(ngModel)]="selectedCustomer.action" placeholder="Set Customer Action">
                <option value="ignore" selected >Ignore | Use only For this Quotation</option>
                <option value="addnew">Add as New Customer</option>
                <option value="update" *ngIf="selectedCustomer.id">Update Existing Customer</option>
              </select></label> -->
    
                    <!-- que -->
    
    
                    <!-- Manual Question handling-->
                    <!-- <ng-container *ngFor="let row of leadstatusdata?.questions ">
    
                      <div class="card" style="padding: 0px;" *ngIf="row.id==118">
                        <div class="card-header"><b style="font-size:1.2em">{{row?.title}}</b>
                          <small *ngIf="row.description"><br>{{row?.description}}</small> </div>
                        <div class="card-body col-sm-12">
                          <div *ngIf="row.input_type=='radio'">
                            <ul>
                              <li>
                                <div *ngFor="let op of row.input_options_array;let i = index">
                                  <label> <input type="radio" slot="start" [checked]="qvalues['_'+row.id]==op" [value]="op"
                                      [(ngModel)]="qvalues['_'+row.id]" [required]="row.is_required==1" name="q_{{row.id}}">
                                    &nbsp;&nbsp;{{op}}</label>
                                </div>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
    
                      <div class="card" style="padding: 0px;" *ngIf=" qvalues._118 == 'Radio' && row.id == 142">
                        <div class="card-header"><b style="font-size:1.2em">{{row?.title}}</b>
                          <small *ngIf="row.description"><br>{{row?.description}}</small> </div>
                        <div class="card-body col-sm-12">
                          <div *ngIf="row.input_type=='select'">
                            <ng-select bindLabel="Select One" [items]="row.input_options_array"
                              [(ngModel)]="qvalues['_'+row.id]" [required]="row.is_required==1" multiple="true">
                              <ng-template ng-option-tmp let-item="item">
                                <span>{{ item }}</span>
                              </ng-template>
                            </ng-select>
                          </div>
                        </div>
                      </div>
    
    
                      <div class="card" style="padding: 0px;" *ngIf=" qvalues._118 == 'Others' && row.id==143">
                        <div class="card-header"><b style="font-size:1.2em">{{row?.title}}</b>
                          <small *ngIf="row.description"><br>{{row?.description}}</small> </div>
                        <div class="card-body col-sm-12">
                          <div *ngIf="row.input_type=='radio'">
                            <ul>
                              <li>
                                <div *ngFor="let op of row.input_options_array;let i = index">
                                  <label> <input type="radio" slot="start" [checked]="qvalues['_'+row.id]==op" [value]="op"
                                      [(ngModel)]="qvalues['_'+row.id]" [required]="row.is_required==1" name="q_{{row.id}}">
                                    &nbsp;&nbsp;{{op}}</label>
                                </div>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
    
    
                      <div class="card" style="padding: 0px;"
                        *ngIf="qvalues._118 == 'Others' && qvalues._143 == 'Others' && row.id == 145">
                        <div class="card-header"><b style="font-size:1.2em">{{row?.title}}</b>
                          <small *ngIf="row.description"><br>{{row?.description}}</small> </div>
                        <div class="card-body col-sm-12">
                          <div *ngIf="row.input_type=='text'">
                            <input type="text" class="form-control " [name]="'q_'+row.id" [required]="row.is_required==1"
                              [(ngModel)]="qvalues['_'+row.id]" placeholder="please enter">
                          </div>
                        </div>
                      </div>
    
                      <div class="card" style="padding: 0px;" *ngIf="qvalues._118 == 'Others' && row.id == 144">
                        <div class="card-header"><b style="font-size:1.2em">{{row?.title}}</b>
                          <small *ngIf="row.description"><br>{{row?.description}}</small> </div>
                        <div class="card-body col-sm-12">
                          <div *ngIf="row.input_type=='select'">
                            <ng-select bindLabel="Select One" [items]="row.input_options_array"
                              [(ngModel)]="qvalues['_'+row.id]" [required]="row.is_required==1" multiple="true">
                              <ng-template ng-option-tmp let-item="item">
                                <span>{{ item }}</span>
                              </ng-template>
                            </ng-select>
                          </div>
                        </div>
                      </div>
    
    
    
                    </ng-container> -->
                    <!-- que close -->
    
                    <!-- sarvye Question handling-->
                    <ng-container *ngFor="let row of leadstatusdata?.questions ">
                      <div class="card" style="padding: 0px;" *ngIf="row.id ==166 && row">
                        <div class="card-header"><b style="font-size:1.2em">{{row?.title}}</b>
                          <small *ngIf="row.description"><br>{{row?.description}}</small> </div>
                        <div class="card-body col-sm-12">
                          <!-- radio -->
                          <div *ngIf="row.input_type=='radio'">
                            <ul>
                              <li>
                                <div *ngFor="let op of row.input_options_array;let i = index">
                                  <label> <input type="radio" slot="start" [checked]="qvalues['_'+row.id]==op" [value]="op"
                                      [(ngModel)]="qvalues['_'+row.id]" [required]="row.is_required==1" name="q_{{row.id}}"
                                      (change)="contactpersonvalidation(); ">
                                    &nbsp;&nbsp;{{op}}</label>
                                </div>
                              </li>
                            </ul>
                          </div>
                          <!-- start of child element-->
                          <ng-container *ngFor="let childrow of getChildQuestions(row)">
                            <ng-container *ngIf="childrow && contactinfoflag ==1">
                              <div class="card" style="padding: 0px;">
                                <div class="card-header"><b style="font-size:1.2em">{{childrow?.title}}</b>
                                  <small *ngIf="childrow.description"><br>{{childrow?.description}}</small> </div>
                                <div class="card-body col-sm-12">
                                  <!-- text -->
                                  <!-- <div *ngIf="childrow.input_type=='text'">
                                  <input type="text" class="form-control " [name]="'q_'+childrow.id"
                                    [required]="childrow.is_required==1" [(ngModel)]="qvalues['_'+childrow.id]"
                                    placeholder="please enter">
                                </div> -->
                                  <!-- file -->
                                  <!-- <div *ngIf="childrow.input_type=='file'">
                                  <input type="file" class="form-control " [name]="'q_'+childrow.id"
                                    [required]="childrow.is_required==1" [(ngModel)]="qvalues['_'+childrow.id]" (change)="onFileChange($event,'document','add')"
                                    placeholder="Attach Media Files..">
                                </div> -->
                                  <!-- radio -->
                                  <div *ngIf="childrow.input_type=='radio'">
                                    <ul>
                                      <li>
                                        <div *ngFor="let op of childrow.input_options_array;let i = index">
                                          <label> <input type="radio" slot="start" [checked]="qvalues['_'+childrow.id]==op"
                                              [value]="op" [(ngModel)]="qvalues['_'+childrow.id]"
                                              [required]="childrow.is_required==1" name="q_{{childrow.id}}">
                                            &nbsp;&nbsp;{{op}}</label>
                                        </div>
                                      </li>
                                    </ul>
                                  </div>
                                </div>
                              </div>
                              <!-- start of child2 element-->
                              <ng-container *ngFor="let childrow2 of getChildQuestions(childrow)">
                                <ng-container *ngIf="childrow2">
                                  <div class="card" style="padding: 0px;">
                                    <div class="card-header"><b style="font-size:1.2em">{{childrow2?.title}}</b>
                                      <small *ngIf="childrow2.description"><br>{{childrow2?.description}}</small> </div>
                                    <div class="card-body col-sm-12">
                                      <!-- text -->
                                      <div *ngIf="childrow2.input_type=='text'">
                                        <input type="text" class="form-control " [name]="'q_'+childrow2.id"
                                          [required]="childrow2.is_required==1" [(ngModel)]="qvalues['_'+childrow2.id]"
                                          placeholder="please enter">
                                      </div>
                                      <!-- file -->
                                      <div *ngIf="childrow2.input_type=='file'">
                                        <input type="file" class="form-control " [name]="'q_'+childrow2.id"
                                          [required]="childrow2.is_required==1" accept=".csv"
                                          (change)="onFileChange($event, childrow2.id)" placeholder="Attach Media Files..">
                                        <!-- [(ngModel)]="qvalues['_'+childrow2.id]" -->
                                        <br><small><a *ngIf="qvalues['_'+childrow2.id]" target=_blank
                                            href="{{qvalues['_'+childrow2.id]}}" style="color: #6B05F9">
                                            {{qvalues['_'+childrow2.id]}}<i class="ti-download"></i>
                                          </a></small>
    
                                      </div>
                                      <!-- radio -->
                                      <div *ngIf="childrow2.input_type=='radio'">
                                        <ul>
                                          <li>
                                            <div *ngFor="let op of childrow2.input_options_array;let i = index">
                                              <label> <input type="radio" slot="start"
                                                  [checked]="qvalues['_'+childrow2.id]==op" [value]="op"
                                                  [(ngModel)]="qvalues['_'+childrow2.id]"
                                                  [required]="childrow2.is_required==1" name="q_{{childrow2.id}}">
                                                &nbsp;&nbsp;{{op}}</label>
                                            </div>
                                          </li>
                                        </ul>
                                      </div>
                                    </div>
                                  </div>
    
                                  <!-- start of child3 element-->
                                  <ng-container *ngFor="let childrow3 of getChildQuestions(childrow2)">
                                    <ng-container *ngIf="childrow3">
                                      <div class="card" style="padding: 0px;">
                                        <div class="card-header"><b style="font-size:1.2em">{{childrow3?.title}}</b>
                                          <small *ngIf="childrow3.description"><br>{{childrow3?.description}}</small> </div>
                                        <div class="card-body col-sm-12">
                                          <!-- text -->
                                          <div *ngIf="childrow3.input_type=='text'">
                                            <input type="text" class="form-control " [name]="'q_'+childrow3.id"
                                              [required]="childrow3.is_required==1" [(ngModel)]="qvalues['_'+childrow3.id]"
                                              placeholder="please enter">
                                          </div>
                                          <!-- file -->
                                          <!-- <div *ngIf="childrow3.input_type=='file'">
                                    <input type="file" class="form-control " [name]="'q_'+childrow3.id"
                                      [required]="childrow3.is_required==1" [(ngModel)]="qvalues['_'+childrow3.id]" 
                                      placeholder="Attach Media Files..">
                                  </div> -->
                                          <!-- radio -->
                                          <div *ngIf="childrow3.input_type=='radio'">
                                            <ul>
                                              <li>
                                                <div *ngFor="let op of childrow3.input_options_array;let i = index">
                                                  <label> <input type="radio" slot="start"
                                                      [checked]="qvalues['_'+childrow3.id]==op" [value]="op"
                                                      [(ngModel)]="qvalues['_'+childrow3.id]"
                                                      [required]="childrow3.is_required==1" name="q_{{childrow3.id}}">
                                                    &nbsp;&nbsp;{{op}}</label>
                                                </div>
                                              </li>
                                            </ul>
                                          </div>
                                        </div>
                                      </div>
    
                                    </ng-container>
                                  </ng-container>
                                  <!--  -->
    
                                </ng-container>
                              </ng-container>
                              <!--  -->
    
                            </ng-container>
                          </ng-container>
                          <!--  -->
                        </div>
                      </div>
    
                    </ng-container>
                    <ng-container *ngIf="quotation.noc ==1 && quotation.lead_id >0">
                      <div class="checkbox-fade fade-in-primary -d">
                        <label><input type=checkbox name="extended_pi" [(ngModel)]="quotation.extended_pi" >
                          <span class="cr"><i class="cr-icon fa fa-check txt-primary"></i></span>
                          <span style="font-size: 15px;font-weight: 600;">Do you want to create Extended PI under COVID Impact</span>
                        </label>
    
                        <!-- <label><input type=checkbox name="extended_pi" [checked]="show" (change)="showdiv()" style="width: 20px;height: 20px;">
                          <span style="color:purple;font-weight:bold"> I confirm that I have checked content of Proforma Invoice. </span>
                        </label> -->
                      </div>
                    </ng-container>
                    <!-- sarvye que close -->
                    <!-- upload Evidence-->
                    <!-- <ng-container>
                      <div class="row">
                        <h4 style="font-size: 15px;font-weight: 600;margin-top: 10px;margin-left:25px;">Evidence Upload : </h4> 
                        <div class="col-sm-6 col-12 col-md-4">
                          <input type="file" class="form-control" name="photo_upload" placeholder="Select files"(change)="onFileChangeUploadEvidence($event)"  accept=".png,.jpg,.jpeg,.mp3, .mpeg , .mp4, .webm, .wmv" multiple>
                        </div>
                        <br>
                       <span style="color: #d34e47; margin-top: 5px;">Note: File type supporting only png, jpg, jpeg, mp3, mpeg, mp4, webm, wmv
                      </span> 
                      </div>
                      <div class="col-sm-8 col-8 row mx-auto " style="display: inline-block;" *ngIf="isloading" >
                        <div class="progress" style="margin-top: 10px;margin-bottom: 10px;">
                          <div class="progress-bar progress-bar-striped"  role="progressbar" [style.width.%]="imgprogress" attr.aria-valuenow="{{imgprogress}}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                      </div>
                       
                      
                      <br>
    
                      <div *ngIf="allevidence.length > 0" class="col-12 col-md-12 col-sm-12 ">
                        <table class="col-12 col-md-12 col-sm-12 " style="width: 100%;"  border=1 cellpadding=3
                        cellspacing=3>
                        <tr>
                          <th class="text-center" style="width: 10%;">Sr.No.</th>
                          <th style="width: 80%;">File Name</th>
                          <th class="text-center" style="width: 10%;" >Action</th>
                        </tr>
                        <tr *ngFor="let tr of allevidence; let i = index">
                          <td class="text-center">{{i+1}}</td>
                          <td><a href="{{tr?.evidenceUrl}}" target="_blank">{{tr?.filename}} </a>
                          </td>
                          <td class="text-center"><a style="color: red" (click)="deleteEvidencefilePopup(tr, i)">
                            <i class="ti-trash"></i>
                          </a></td>
                        </tr>
                        </table>
                        <br>
                      </div>
                    </ng-container> -->
                  </div>
                </div>
              </div>
    
    
            </div>
    
            <div class="centered-content">
              <div class="btn-group mt-10">
                <span *ngIf="!selectedCustomer?.name">
                  <button type="button" class="btn btn-primary btn-xl"
                    (click)="commonService.windowpopup('/customer/add')"><i class="fa fa-external-link"
                      aria-hidden="true"></i> Add new Customer</button>
                  <hr>
                </span>
    
                <!--  <a  (click)="commonService.windowpopup('/customer/add')">+ Add New <i class="fa fa-external-link" aria-hidden="true"></i></a>-->
                <!-- <span
                  *ngIf="selectedUser?.id && selectedCustomer?.name && selectedCustomer?.pincode && selectedCustomer?.state  && selectedCustomer?.address_line_1 && selectedCustomer?.contact_no && selectedCustomer?.contact_person && selectedCustomer?.contact_email  && selectedCustomer.contact_designation && checkQvalues() &&  queFlag == 1 && regionflag ==1"> -->
                  <span
                  *ngIf="selectedUser?.id && selectedCustomer?.name && selectedCustomer?.pincode && selectedCustomer?.state  && selectedCustomer?.address_line_1 && selectedCustomer?.contact_no && selectedCustomer?.contact_person && selectedCustomer?.contact_email  && selectedCustomer.contact_designation && regionflag ==1 && quotation.lead_id > 0 ">
                  <!-- && checkQvalues() &&  queFlag == 1-->
                  <button [disabled]="!selectedCustomer" type="button" class="btn btn-primary btn-xl" nextStep>Continue <i
                      class="fa fa-arrow-right" aria-hidden="true"></i></button>
                </span>
    
              </div>
              <span
                *ngIf="!selectedCustomer?.name || !selectedCustomer?.address_line_1 || !selectedCustomer?.contact_no || !selectedCustomer?.pincode || !selectedCustomer?.contact_person || !selectedCustomer?.contact_email">
                <br>
                <hr>
                <span style="color:red">*</span> Fields are Mandatory <br>
                <!-- <b>Tax invoice will be printed in the name and address of the customer
                  provided here</b> -->
                <!-- <br>&nbsp; <br>&nbsp; <br>&nbsp; <br>&nbsp; <br>&nbsp; <br>&nbsp; <br>&nbsp; <br>&nbsp; <br>&nbsp; -->
              </span>
    
            </div>
    
    
          </div>
          <!-- ======================================= customer info first step end ================================================================ -->
  
          <div>
            <!-- <p>Go to a different step to see the error state</p> -->
            <button mat-button matStepperNext>Next</button>
          </div>
      </mat-step>
      <!-- ========================================= LICENSE CATEGORIES second setp start ============================================================= -->
      <mat-step [stepControl]="secondFormGroup" errorMessage="Address is required.">
        <form [formGroup]="secondFormGroup">
          <ng-template matStepLabel>LICENSE CATEGORIES</ng-template>
          <mat-form-field>
            <mat-label>Address</mat-label>
            <input matInput placeholder="Ex. 1 Main St, New York, NY" formControlName="secondCtrl"
                   required>
          </mat-form-field>
          <div class="centered-content">
            <h4>Select License Category</h4>
          </div>
          <hr>
          <span *ngIf="licenseCategories">
            Filter : 
            <label style="display:none">
                <input type="radio" name="lcatfilter" [checked]="activefilter === 'all'" (change)="filterlc('all'); activefilter='all'"> All
            </label> &nbsp;&nbsp; 
            <label>
                <input type="radio" name="lcatfilter" (change)="filterlc('bg'); activefilter='bg'"> Background
            </label> &nbsp;&nbsp; 
            <label>
                <input type="radio" name="lcatfilter" (change)="filterlc('event'); activefilter='event'; ltype='New'"> Events
            </label> &nbsp;&nbsp; 
            <label>
                <input type="radio" name="lcatfilter" (change)="filterlc('penalty'); activefilter='penalty'; ltype='New'"> Damages
            </label>
        
            <div [hidden]="activefilter === 'event' || rejectedArray.length < 1" *ngIf="rejectedArray.length > 0 && (activefilter !== 'event' && activefilter !== 'all')" class="col-md-2 col-xl-2" style="float: right;" (click)="checkRejectedCart(); modalrejectcart.show();">
              <button type="button" class="btn btn-primary btn-sm">Rejected Cart</button>
          </div>
          
        </span>

          <div>
            <p>Go to a different step to see the error state</p>
            <button mat-button matStepperPrevious>Back</button>
            <button mat-button matStepperNext>Next</button>
          </div>
        </form>
      </mat-step>

      <!-- ========================================= LICENSE CATEGORIES second setp end ============================================================= -->
      
      <mat-step>
        <ng-template matStepLabel>CHECKOUT</ng-template>
        <p>You are now done.</p>
        <div>
          <button mat-button matStepperPrevious>Back</button>
          <button mat-button (click)="stepper.reset()">Reset</button>
        </div>
      </mat-step> 
    </mat-stepper>
    <!-- ################################################################## new stepper code end #################################################################### -->

   
    <wizard-step stepTitle="License Categories" optionalStep>
      <div class="centered-contentt">
        <div>
         
        

          <!-- try -->
          <!-- <span *ngIf="licenseCategories && (this.qvalues._166 == 'Multiple Outlets' || qvalues._166 == 'Stand-alone store')">
              Filter : <label style="display:none"> <input type=radio name="lcatfilter" [checked]="activefilter=='all'" 
                  (change)="filterlc('all');activefilter='all'"> All</label> &nbsp;&nbsp; 
                  <label> <input
                  (change)="filterlc('bg');activefilter='bg'" type=radio name="lcatfilter" [checked]="activefilter=='bg'" value ="bg"> Background</label>
              
            </span>
            <span *ngIf="licenseCategories && this.qvalues._166 == 'Event'">
                Filter : <label style="display:none"> <input type=radio name="lcatfilter" [checked]="activefilter=='all'"
                    (change)="filterlc('all');activefilter='all'"> All</label> &nbsp;&nbsp; 
        
               
                 <label> <input (change)="filterlc('event');activefilter='event';ltype='New'" type=radio
                    name="lcatfilter" [checked]="activefilter=='event'" value ="event"> Events</label>
              </span> -->
          <!-- close -->

          <div class="row" *ngIf="false && licenseCategories && (activefilter=='bg' || activefilter=='event'|| activefilter=='penalty')">
            <div class="col-md-1 col-xl-1">Sn.</div>
            <div class="col-md-5 col-xl-5">License Category</div>
            <div class="col-md-2 col-xl-2">No. Of Licenses</div> |
            <div class="col-md-2 col-xl-2">Total</div>

          </div>
         



          <div class="row" style="border: 1px solid #e4e4e4;
 padding: 5px;
 box-shadow: 2px 2px 2px skyblue;" *ngIf="licenseCategories && (activefilter=='bg' || activefilter=='event' || activefilter=='penalty')">



            <div class="col-1">*</div>

            <div class="col-md-6">
              <span *ngIf="activefilter !== 'event' && activefilter !== 'bg' && activefilter !== 'penalty'">
                <b [hidden]="activefilter=='event' || activefilter=='penalty'"><label><input type=radio name="ltype" [checked]="ltype=='New'"
                      [(ngModel)]="ltype" value="New"> New</label> &nbsp;&nbsp;
                  <label><input type=radio name="ltype" [checked]="ltype=='Renewal'" [(ngModel)]="ltype"
                      value="Renewal"> Renewal </label>
                </b>
                <hr [hidden]="activefilter=='event'">

                <!--  [groupBy]="catGroupByFn" -->
                <ng-select placeholder="Select License Category" (change)="setSelectedSlc($event)"
                  bindLabel="displayname" [items]="licenseCategories" autocomplete="off">
                  <!-- [(ngModel)]="selectedSlc"-->

                  <ng-template ng-option-tmp let-item="item">
                    <span *ngIf="item.active==0" style="color:red">{{ item.displayname  }}</span>
                    <span *ngIf="item.active==1">{{ item.displayname  }}</span>
                  </ng-template>

                </ng-select>
              </span>

              <div *ngIf="selectedSlc?.id > 0">
                <!--              <small> {{selectedSlc.desc1}} </small>-->
                <hr>

                <div *ngFor="let cf of selectedSlc.custom_fields; let i = index">
                  <span *ngIf="cf.is_premium==0">
                    
                    <div *ngIf="cf.f_type=='range_field' && (_can_show_condition_field(selectedSlc,cf)) ">
                      {{cf.f_name}} : <input type=number [min]="selectedSlc.custom_fields[i].min_value" value="1"
                        step="1" oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                        [(ngModel)]="selectedSlc.custom_fields[i].setcartvalue" [required]="cf?.is_required==1" /> {{cf.single_field_desc}}
                    </div>

                    <!-- (change)="updateSelectCatTotalCf($event,selectedSlc, cf,i)" -->
                    <div *ngIf="cf.f_type=='category_field' && (_can_show_condition_field(selectedSlc,cf))" style="border:1px solid #e4e4e4;padding:10px">
                      {{cf.name}} : <ng-select (change)="conditionFieldNoCheck(cf);checkForCityClass(selectedSlc.custom_fields[i]);conditionFieldvalidateCheck(selectedSlc);"
                        [searchable]="false" [clearable]="false" placeholder="{{cf.name}}" bindLabel="name"
                        [items]="cf.category_options" [(ngModel)]="selectedSlc.custom_fields[i].setcartvalue">
                      </ng-select> {{cf.single_field_desc}}
                      <div *ngIf="cf.addfield_f_name.length > 1 && selectedSlc.custom_fields[i].setcartvalue"
                        style="padding:3px">

                        <span *ngIf="selectedSlc.custom_fields[i].setcartvalue.addfield_desc.length > 1">
                          {{ cf.addfield_f_name }}:
                          <input type="number" min="0" 
                                 (input)="validate_add_max($event, selectedSlc.custom_fields[i].setcartvalue.addfield_max_value, i)"
                                 [max]="selectedSlc.custom_fields[i].setcartvalue.addfield_max_value"
                                 [(ngModel)]="selectedSlc.custom_fields[i].setaddcartvalue">
                          {{ selectedSlc.custom_fields[i].setcartvalue.addfield_desc }}
                        </span>
                        

                      </div>
                    </div>
                    <div *ngIf="cf.f_type=='single_field' && (_can_show_condition_field(selectedSlc,cf))" style="padding:5px;">
                      {{cf.f_name}} : <input type=number [min]="selectedSlc.custom_fields[i].min_value"
                        [max]="selectedSlc.custom_fields[i].max_value" value="1" step="1"
                        oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                        [(ngModel)]="selectedSlc.custom_fields[i].setcartvalue" [required]="cf?.is_required==1" /> {{cf.single_field_desc}}
                    </div>
                    <div *ngIf="cf.f_type=='matrix_field'" style="border:1px solid #e4e4e4;padding:10px">
                      {{cf.name}} : <ng-select (change)="checkForCityClass(selectedSlc.custom_fields[i])"
                        [searchable]="false" [clearable]="false"
                        (change)="selectedSlc.custom_fields[i].setaddcartvalue=0" placeholder="{{cf.name}}"
                        bindLabel="name" [items]="cf.category_options"
                        [(ngModel)]="selectedSlc.custom_fields[i].setcartvalue"> </ng-select> {{cf.single_field_desc}}
                      <div *ngIf="cf.addfield_desc.length > 1 && selectedSlc.custom_fields[i].setcartvalue"
                        style="padding:3px">
                        <span *ngIf="selectedSlc.custom_fields[i].setcartvalue.addfield_desc.length > 1">
                          {{cf.addfield_f_name}} : <input type=number min=0 step="1"
                            oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                            [(ngModel)]="selectedSlc.custom_fields[i].setaddcartvalue"> {{cf.addfield_desc}} </span>
                      </div>
                    </div>

                  </span>

                </div>

                <span *ngIf="selectedSlc.premium_enable==1">
                  <hr>
                  <div class="checkbox-fade fade-in-primary d-">
                    <label><input type=checkbox [(ngModel)]="selectedSlc.setcartpremium_enable">
                      <span class="cr"><i class="cr-icon fa fa-check txt-primary"></i></span>
                      <span> {{selectedSlc.premium_name}} </span>
                    </label>
                  </div>
                  <br>

                  <div *ngFor="let cf of selectedSlc.custom_fields; let i = index">
                    <span *ngIf="cf.is_premium==1 && selectedSlc.setcartpremium_enable== true">
                      <div *ngIf="cf.f_type=='single_field'">
                        {{cf.f_name}} : <input type=number min=0 step="1"
                          oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                          [(ngModel)]="selectedSlc.custom_fields[i].setcartvalue" /> {{cf.single_field_desc}}
                      </div>
                      <!-- (change)="updateSelectCatTotalCf($event,selectedSlc, cf,i)" -->
                      <div *ngIf="cf.f_type=='category_field'" style="border:1px solid #e4e4e4;padding:10px">
                        {{cf.name}} : <ng-select [searchable]="false" [clearable]="false" placeholder="{{cf.name}}"
                          bindLabel="name" [items]="cf.category_options"
                          [(ngModel)]="selectedSlc.custom_fields[i].setcartvalue"> </ng-select> {{cf.single_field_desc}}
                        <div
                          *ngIf="cf.addfield_f_name.length > 1 && selectedSlc.custom_fields[i].setcartvalue.addfield_desc!='0' && selectedSlc.custom_fields[i].setcartvalue"
                          style="padding:3px">
                          {{cf.addfield_f_name}} : <input type=number min=0 step="1"
                            oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                            [(ngModel)]="selectedSlc.custom_fields[i].setaddcartvalue">
                          {{selectedSlc.custom_fields[i].setcartvalue.addfield_desc}}
                        </div>
                      </div>
                      <div *ngIf="cf.f_type=='matrix_field'" style="border:1px solid #e4e4e4;padding:10px">
                        {{cf.name}} : <ng-select [searchable]="false" [clearable]="false" placeholder="{{cf.name}}"
                          bindLabel="name" [items]="cf.category_options"
                          [(ngModel)]="selectedSlc.custom_fields[i].setcartvalue"> </ng-select> {{cf.single_field_desc}}
                        <div
                          *ngIf="cf.addfield_desc.length > 1 && cf.addfield_desc!='0' && selectedSlc.custom_fields[i].setcartvalue"
                          style="padding:3px">
                          {{cf.addfield_f_name}} : <input type=number min=0 step="1"
                            oninput="this.value=this.value.replace(/[^0-9]/g,'');"
                            [(ngModel)]="selectedSlc.custom_fields[i].setaddcartvalue"> {{cf.addfield_desc}}
                        </div>
                      </div>

                    </span>

                  </div>
                </span>

              </div>


              <div class="row" *ngIf="selectedSlc?.id > 0">
                <hr>

                <div class="col-sm-12 col-md-12 col-xl-12">
                  <span [hidden]="selectedSlc.show_no_of_usages==0">
                    {{selectedSlc.no_of_usages_f_name}} : <input (change)=validate_no_of_usages($event) type=number
                      min=1 placehodeler="usages/days/year" step="1"
                      oninput="this.value=this.value.replace(/[^0-9]/g,'');" value=1 style="width:50px"
                      [(ngModel)]="selectedSlc.no_of_usages">
                    <!--  {{selectedSlc.no_of_usages * selectedSlc.usage_multiplier}} Total Usages --> </span>
                  <br>
                  <hr>
                  <div *ngIf="selectedSlc.cat_idcode == '49'  || selectedSlc.cat_idcode == '49 - V2022' || selectedSlc.cat_idcode == '33(L)'" style="padding-bottom:10px"> 
                      Category Description :
                      <!-- <input class="form-control" type="textarea" placeholder="Category Description"  [(ngModel)]="selectedSlc.cat_description"> -->
                      <textarea class="form-control" [(ngModel)]="selectedSlc.cat_description"
                      placeholder="Category Description" required></textarea>
                  <hr>
                  </div>
                  <div *ngIf="selectedSlc.cat_idcode == 'PD (1)'" style="padding-bottom:10px"> 
                    Additional Remarks :
                    <!-- <input class="form-control" type="textarea" placeholder="Category Description"  [(ngModel)]="selectedSlc.cat_description"> -->
                    <textarea class="form-control" [(ngModel)]="selectedSlc.cat_description"
                    placeholder="Category Description" required></textarea>
                
                </div>

                  <div *ngIf="selectedSlc.cat_idcode == 'PD (1)'" style="padding-bottom:10px"> 
                    Proforma Invoice No. , If any  :
                    <!-- <input class="form-control" type="textarea" placeholder="Category Description"  [(ngModel)]="selectedSlc.cat_description"> -->
                    <input class="form-control" type="number" [(ngModel)]="selectedSlc.penalty_pino"
                    placeholder="PI Number" required >
                
                </div>
                <div  *ngIf="selectedSlc.cat_type==='penalty'"><br>
                    
                  <input class="form-control" type="text" placeholder="Internal Notes"
                    [(ngModel)]="selectedSlc.notes">
                    <hr>
                </div>

                  <div *ngIf="selectedSlc.cat_type==='event'">
                    <span> Event Type : <span style="color:red">*</span><ng-select  bindLabel="name"
                        [items]="eventtypes" [loading]="eventtypesLoading" [typeahead]="custTypeaheadEventtypes"
                        placeholder="Search Event Type" bindValue="name" [(ngModel)]="selectedSlc.event_type">
                      </ng-select>
                      <hr> </span>

                    <span *ngIf="selectedSlc.id== 46">
                      <!-- *ngIf="selectedSlc.id== 46 && quotation.noc == 1" -->
                      Event Sub Type :
                      <br>
                      <label> <input type=radio name="eventsubtype" value="Wedding Event"
                          [(ngModel)]="selectedSlc.eventsubtypes"> Wedding Event</label> &nbsp;
                      <label> <input type=radio name="eventsubtype" value="Wedding Related Event"
                          [(ngModel)]="selectedSlc.eventsubtypes"> Wedding Related Event</label> &nbsp;
                      <label> <input type=radio name="eventsubtype" value="Birthday"
                          [(ngModel)]="selectedSlc.eventsubtypes"> Birthday </label> &nbsp;
                      <label> <input type=radio name="eventsubtype" value="Others"
                          [(ngModel)]="selectedSlc.eventsubtypes"> Others</label> &nbsp;
                      <hr>
                    </span>

                    <!-- [disabled]="selectedSlc.event_fixedname"-->
                    <input  class="form-control" type="text"
                      placeholder="Event name/title *" [(ngModel)]="selectedSlc.event_name"> <br>

                    <input class="form-control" type="datetime-local" placeholder="Event Start DateTime *"
                      [(ngModel)]="selectedSlc.event_start_datetime" (change)="update_event_end_datetime()">
                    <input [hidden]="selectedSlc.hideeventenddate==1" class="form-control" type="datetime-local"
                      placeholder="Event End DateTime *" [(ngModel)]="selectedSlc.event_end_datetime" disabled> <br>
                    <!--<input  class="form-control" type="text" placeholder="Event Venue" [(ngModel)]="selectedSlc.event_venue"> <br> -->
                    <!--depr [hidden]="selectedSlc.event_venue"-->

                     <span> Venue Name Search : <span style="color:red">*</span> <ng-select (ngModelChange)="select_event_venue_tag()" bindLabel="name" [items]="venues" [loading]="venueLoading"
                        [typeahead]="custTypeaheadVenue" placeholder="Search Existing Venue" bindValue="name"
                        [(ngModel)]="selectedSlc.event_venue">
                      </ng-select> </span>
                      <br>
                    <div > Event Venue Tag: 
 <br>
 <span>
  <input  class="form-control"  name=event_tag bindLabel="name"
  placeholder=""
 [(ngModel)]="selectedSlc.event_tag" required disabled> 

 </span>
                     </div> <br>

                      <!-- <span> Event Venue Tag  : <ng-select bindLabel="name" [items]="event_venue_tag" [loading]="eventvenuetagLoading"
                        [typeahead]="custTypeaheadEventvenuetag" placeholder="Search Existing Venue" bindValue="name"
                        [(ngModel)]="selectedSlc.event_venue_tag">
                      </ng-select> </span> -->
                    <!-- Depreciated
                        <input  class="form-control" type="text" placeholder="or Add new Event Venue Name *" [(ngModel)]="selectedSlc.event_venue"> <br>
                                  -->
                    <!-- Depreciated  <input  class="form-control" type="text" placeholder="Venue Location *" [(ngModel)]="selectedSlc.event_location"> <br>
                      <input  class="form-control" type="number" placeholder="Venue Pincode *" [(ngModel)]="selectedSlc.event_pincode"> <br> -->

                    <div class="form-group row">

                      <div class="col-sm-12" *ngIf=states><br>
                        Event State : <span style="color:red">*</span>
                        <!--  <input placeholder = "State" class="form-control  " disabled [(ngModel)]="selectedCustomer.state" name="state" required>
                          -->
                        <ng-select placeholder="Select State" name="event_state"
                          (change)="lookupstate=selectedSlc.event_state;cities = [];selectedSlc.event_city='';" required
                          bindLabel="state" bindValue="state" [items]="states" [(ngModel)]="selectedSlc.event_state">
                        </ng-select>
                      </div>


                      <div class="col-sm-12"><br>
                        Event City : <span style="color:red">*</span>
                        <!-- <input type="text" id="autocomplete" class="form-control " name="city" autocorrect="off" placeholder="City" [(ngModel)]="selectedCustomer.city"   required>
                            -->

                        <ng-select name=event_city bindLabel="name" bindValue="name" [items]="cities"
                          [loading]="cityLoading" [typeahead]="custTypeaheadCity" placeholder="Search Existing City"
                          [(ngModel)]="selectedSlc.event_city" required>
                        </ng-select>

                      </div>


                    </div>

                  
                    <!-- - <div class="form-group row">

                      <div class="col-sm-12"><br>
                        
                        
                        <span> Venue Name Search : <span style="color:red">*</span> <ng-select  bindLabel="name" [items]="venues" [loading]="venueLoading"
                        [typeahead]="custTypeaheadVenue" placeholder="Search Existing Venue" bindValue="name" (change)="lookupstate=selectedSlc.event_venue;metaeventvenuetag=[];selectedSlc.event_venue_tag='';"
                        [(ngModel)]="selectedSlc.event_venue">
                      </ng-select> </span>
                      </div>
                    

                      <div class="col-sm-12"><br>
                        event venue tag : <span style="color:red">*</span>
                       

                        <ng-select name=event_venue_tag bindLabel="name" bindValue="name" [items]="metaeventvenuetag"
                          [loading]="eventvenuetagLoading" [typeahead]="custTypeaheadEventtag" placeholder=""
                          [(ngModel)]="selectedSlc.event_venue_tag" required>
                        </ng-select>

                      </div>


                    </div>  -->
                    

                    <input class="form-control" type="text" placeholder="Additional Info / No of Pax *"
                      [(ngModel)]="selectedSlc.event_extra"> <br>

                    <input class="form-control" type="text" placeholder="Internal Notes"
                      [(ngModel)]="selectedSlc.notes"> <br>

                  </div>
                  <div *ngIf="selectedSlc.cat_type==='bg'">
                    Start Date : <input (change)="selectedSlc.end_date=nextYearDate(selectedSlc.start_date)" type=date
                      [(ngModel)]="selectedSlc.start_date" class="form-control"><Br>End Date : <input
                      class="form-control" type=date [(ngModel)]="selectedSlc.end_date"
                      (change)="ValidateSelectedSlcStartEndDate()">
                  </div>
                  <hr>
                  <div [hidden]="activefilter=='penalty'">
                    Licensee Details : <span style="color:red">*</span>
                    <input class="form-control" type="text" placeholder="Licensee Name *"
                      [(ngModel)]="selectedSlc.l_name">
                    <input class="form-control" type="text" placeholder="Licensee franchise "
                      [(ngModel)]="selectedSlc.l_franchise">
                    <!--  <input  class="form-control" type="text" placeholder="Licensee Address *" [(ngModel)]="selectedSlc.l_address">-->

                    <input class="form-control" type="text" placeholder="Licensee Address 1"
                      [(ngModel)]="selectedSlc.l_address_line_1">
                    <input class="form-control" type="text" placeholder="Licensee Address 2"
                      [(ngModel)]="selectedSlc.l_address_line_2">
                    <input class="form-control" type="text" placeholder="Licensee Address 3"
                      [(ngModel)]="selectedSlc.l_address_line_3">

                    <input class="form-control" type="number" placeholder="Licensee Pincode *"
                      [(ngModel)]="selectedSlc.l_pincode">

                    <div class="form-group row">

                      <div class="col-sm-12" *ngIf=states><br>
                        State : <span style="color:red">*</span>
                        <!--  <input placeholder = "State" class="form-control  " disabled [(ngModel)]="selectedCustomer.state" name="state" required>
                      -->
                        <ng-select placeholder="Select State" name="l_state"
                          (change)="lookupstate=selectedSlc.l_state;cities = [];selectedSlc.l_city='';" required
                          bindLabel="state" bindValue="state" [items]="states" [(ngModel)]="selectedSlc.l_state">
                        </ng-select>
                      </div>


                      <div class="col-sm-12"><br>
                        City : <span style="color:red">*</span>
                        <!-- <input type="text" id="autocomplete" class="form-control " name="city" autocorrect="off" placeholder="City" [(ngModel)]="selectedCustomer.city"   required>
                        -->

                        <ng-select *ngIf="selectedSlc.cat_type==='bg'" name=l_city bindLabel="name" bindValue="name" [items]="cities"
                          [loading]="cityLoading" [typeahead]="custTypeaheadCity" placeholder="Search Existing City"
                          [(ngModel)]="selectedSlc.l_city" required>
                        </ng-select>

                        <ng-select *ngIf="selectedSlc.cat_type==='event'" name=l_city bindLabel="name" bindValue="name" [items]="cities"
                          [loading]="cityLoading" [typeahead]="custTypeaheadeCityevent" placeholder="Search Existing City"
                          [(ngModel)]="selectedSlc.l_city" required>
                        </ng-select>

                      </div>
                      <div class="col-sm-12" *ngIf="selectedSlc.cat_type==='bg'"><br>
                        <input class="form-control" type="text" placeholder="Additional Info / No of Pax *"
                          [(ngModel)]="selectedSlc.event_extra"> <br>

                        <input class="form-control" type="text" placeholder="Internal Notes"
                          [(ngModel)]="selectedSlc.notes">
                      </div>

                      <!-- <div class="col-sm-12" *ngIf="allevidence && allevidence.length > 0">
                      <br>
                      Select Evidence : &nbsp;&nbsp;
                      <button class="button" class="btn btn-info btn-sm" (click) = "modalevidence.show(); openmodalselectfile() "> Add Evidence</button>
                      <br>
                    </div> -->
                      <!-- <div class="col-sm-12 mt-2"  *ngIf="selectedSlc?.cartevidence && selectedSlc?.cartevidence?.length > 0">
                        <table class="col-12 col-md-12 col-sm-12 " style="width: 100%;" border=1 cellpadding=3 cellspacing=3>
                        <tr>
                          <th class="text-center" style="width: 10%;">Sr. No.</th>
                          <th style="width: 90%;">File Name</th>
                        </tr>
                        <tr *ngFor="let evidence of selectedSlc?.cartevidence;let i =index;">
                          <td class="text-center">{{i+1}}</td>
                          <td><a href="{{evidence?.evidenceUrl}}" target="_blank">{{evidence?.filename}} </a>
                          </td>
                        </tr>
                        </table>
                        <br>
                    </div> -->

                    </div>


                  </div>

                  
                  <!-- <small> {{selectedSlc.desc2}} </small> -->

                  <hr>
                  <!-- Selected SLC MultiInvoice Start -->
                  <!--  <b> Multi Invoice Fields : (only in case of Multi Invoice - Keep blank for single Invoice)</b><br>
                  <br>Invoice Name : 
                  <input  class="form-control" type="text" placeholder="Name" [(ngModel)]="selectedSlc.mi_name"> 
                  <br>GST No.: 
                  <input  class="form-control" type="text" placeholder="GST No." [(ngModel)]="selectedSlc.mi_gst"> 
                 <Br> Address Line  1 :
                  <input  class="form-control" type="text" placeholder="Address Line 1" [(ngModel)]="selectedSlc.mi_address_line_1">
                  <br>Address Line  2 :
                  <input  class="form-control" type="text" placeholder="Address Line 2" [(ngModel)]="selectedSlc.mi_address_line_2">
                  <br>Town / Locality :
                  <input  class="form-control" type="text" placeholder="Address Line 3" [(ngModel)]="selectedSlc.mi_address_line_3">
                  <Br>Pincode :
                  <input  class="form-control" type="text" placeholder="Pincode" [(ngModel)]="selectedSlc.mi_pincode">
                  <br>City :
                  <input  class="form-control" type="text" placeholder="City" [(ngModel)]="selectedSlc.mi_city">
                  <br>State :
                  <input  class="form-control" type="text" placeholder="state" [(ngModel)]="selectedSlc.mi_state">
                  -->
                  <!-- Selected SLC MultiInvoice End -->
                </div>
                <!-- <div class="col-sm-12 col-xl-6">
                        Start Date : <input  type=date [(ngModel)]="selectedSlc.start_date"> </div> -->
              </div>
            </div>


            <div class="col-md-2">
              Quantity :
              <input width=20px type="number" disabled *ngIf="selectedSlc?.id > 0" value=1 class="form-control" min=1
                placeholder="quantity" [(ngModel)]="selectedSlc.quantity">
            </div>
            <div class="col-md-3">
              <span *ngIf="selectedSlc?.id >0 ">
                <span *ngIf="getCatTotal(selectedSlc)>0"> 
                  {{getCatTotal(selectedSlc) * selectedSlc.quantity * selectedSlc.no_of_usages  * selectedSlc.usage_multiplier | number : '1.0-0' }}
                  <hr> <!-- *ngIf="getCatTotal(selectedSlc) > 0 "-->
                  <button style="margin:2px" class="button" (click)="cart_add()" class="btn btn-primary btn-sm">Add to
                    Cart</button>


                  <hr> <!-- *ngIf="getCatTotal(selectedSlc) > 0"-->
                  <button style="margin:2px" class="button" (click)="buyNow()" class="btn btn-primary btn-sm">Buy
                    Now</button>
                </span>

              </span>

              <div *ngIf="activefilter !== 'penalty'">                <hr>
                <label for="upload2">
                  <span class="btn btn-info btn-sm f-right">Bulk Upload</span>
                  <input type="file" id="upload2" style="display:none" accept=".csv"
                    (change)="onBUFileChange($event)"> 
                </label> <br>
                <a href="{{commonService.apiUrl}}/others/sampleBulkUpload_new.csv" target="_blank">Download Sample CSV</a>
              </div>
            </div>
            </div>
          </div>
          <hr>

          <!-- <div class="centered-content" *ngIf="allSelectedLc.length<1">
            Cart is Empty
          </div> -->
          <div class="centered-contentt" *ngIf="allSelectedLc.length>0">
            <div class="centered-content" style="font-size: 1.3em">Cart Items - <small style="color:red;cursor:pointer"
                (click)="cart_alldelete()">Clear all </small></div>

            <div class="row">
              <div class="col-1">Sn.</div>
              <div class="col-7">License Category</div>
              <!--       <div class="col-sm-2 col-xl-2">No. Of Licenses</div>-->
              <div class="col-3">Total</div>
            </div>
            <div class="row" *ngFor="let slc of allSelectedLc;let i = index" style="border: 1px solid #e4e4e4;
/* padding: 10px;*/
 box-shadow: 1px 1px 1px gray;">
              <div class="col-1"> {{i+1}}</div>
              <div class="col-7">
                <b> {{slc?.displayname}} </b> <br>
                <span *ngIf="slc.cat_type=='bg'">
                  {{slc.ltype}}
                  <br></span>
                  <!-- <div *ngFor="let cf of getcustomfields(slc.custom_fields)">
                    <span *ngIf="(cf.f_type=='single_field' || cf.f_type=='range_field') && cf.setcartvalue && (!cf.is_show || (cf.is_show && cf?.is_show==1))">
                      {{ cf.f_name }}: {{ cf.setcartvalue }} {{ cf.single_field_desc }}
                    </span>
                    <span *ngIf="cf.f_type!='single_field' && cf.f_type!='range_field' && cf.setcartvalue">
                      {{ cf.name }}: {{ getCfValue(cf) }}
                      <span *ngIf="cf.setaddcartvalue && cf.setcartvalue.addfield_desc && cf.setcartvalue.addfield_desc.length > 1">
                        <br>
                        <i>{{ cf.addfield_name }}: {{ cf.setaddcartvalue }}</i>
                      </span>
                    </span>
                  </div>
                   -->
                <span *ngIf="slc.setcartpremium_enable"><b> {{ slc.premium_name }}</b></span>

                <span [hidden]="allSelectedLc[i].show_no_of_usages==0">
                  {{allSelectedLc[i].no_of_usages_f_name}} : <input type=number min=1 placehodeler="usages/days/year"
                    value=1 style="width:50px" [(ngModel)]="allSelectedLc[i].no_of_usages" disabled>
                  <!--  {{allSelectedLc[i].no_of_usages * allSelectedLc[i].usage_multiplier}} Total Usages --> </span>
                <br>
                <hr>
                <div *ngIf="allSelectedLc[i].cat_idcode === '49' || allSelectedLc[i].cat_idcode == '49 - V2022' || allSelectedLc[i].cat_idcode == '33(L)'" style="padding-bottom:10px"> 
                    Category Description :
                    <!-- <input class="form-control" type="text" placeholder="Category Description"  [(ngModel)]="allSelectedLc[i].cat_description"> -->
                    <textarea class="form-control" readonly [(ngModel)]="allSelectedLc[i].cat_description"
                    placeholder="Category Description"></textarea>
                    <hr>
                </div>
                <div *ngIf="allSelectedLc[i].cat_idcode === 'PD (1)'" style="padding-bottom:10px"> 
                  <span>Additional Remarks : {{allSelectedLc[i].cat_description}}</span> <br>
                  <span>Proforma Invoice No. : {{allSelectedLc[i].penalty_pino}}</span> <br>
                  <span>Internal Notes : {{allSelectedLc[i].notes}}</span> <br>
                  <hr>
              </div>

                <div *ngIf="allSelectedLc[i].cat_type==='event'">
                  <input disabled class="form-control" type="text" placeholder="Event name/title"
                    [(ngModel)]="allSelectedLc[i].event_name"> <br>
                  <input disabled class="form-control" type="text" placeholder="Event Type"
                    [(ngModel)]="allSelectedLc[i].event_type"> <br>

                  <input *ngIf="allSelectedLc[i].id == 46" disabled class="form-control" type="text" placeholder="Event Sub Type"
                    [(ngModel)]="allSelectedLc[i].eventsubtypes"> <br *ngIf="allSelectedLc[i].id == 46">

                  <input disabled class="form-control" type="datetime-local" placeholder="Event Start DateTime"
                    [(ngModel)]="allSelectedLc[i].event_start_datetime">
                  <input [hidden]="allSelectedLc[i].hideeventenddate==1" disabled class="form-control"
                    type="datetime-local" placeholder="Event End DateTime"
                    [(ngModel)]="allSelectedLc[i].event_end_datetime"> <br>
                    
                  <input disabled class="form-control" type="text" placeholder="Event Venue Name"
                    [(ngModel)]="allSelectedLc[i].event_venue"> <br>

                    <span *ngIf="allSelectedLc[i].event_tag"><input  disabled class="form-control" type="text" placeholder="Event Type"
                      [(ngModel)]="allSelectedLc[i].event_tag"> <br></span>
                  <!---  <input disabled class="form-control" type="text" placeholder="Venue Location" [(ngModel)]="allSelectedLc[i].event_location"> <br>
                <input disabled class="form-control" type="text" placeholder="Venue Pincode" [(ngModel)]="allSelectedLc[i].event_pincode"> <br>-->
                  <input disabled class="form-control" type="text" placeholder="Event State"
                    [(ngModel)]="allSelectedLc[i].event_state"> <br>
                  <input disabled class="form-control" type="text" placeholder="Event City"
                    [(ngModel)]="allSelectedLc[i].event_city"> <br>
                  <input disabled class="form-control" type="text" placeholder="Additional Info / No Of Pax"
                    [(ngModel)]="allSelectedLc[i].event_extra"> <br>

                </div>
                <div *ngIf="allSelectedLc[i].cat_type==='bg'">
                  Start Date : <input disabled
                    (change)="allSelectedLc[i].end_date=nextYearDate(allSelectedLc[i].start_date)" type=date
                    [(ngModel)]="allSelectedLc[i].start_date" class="form-control">
                  <Br>End Date : <input class="form-control" disabled type=date [(ngModel)]="allSelectedLc[i].end_date">
                </div>
                <hr>
                <div *ngIf="allSelectedLc[i].cat_type!='penalty'">
                  Licensee Details : *
                  <input class="form-control" type="text" placeholder="Licensee Name" disabled
                    [(ngModel)]="allSelectedLc[i].l_name">
                  <input class="form-control" type="text" placeholder="Licensee franchise " disabled
                    [(ngModel)]="allSelectedLc[i].l_franchise">

                  <!-- <input  class="form-control" type="text" placeholder="Licensee Address" disabled [(ngModel)]="allSelectedLc[i].l_address"> 
            -->
                  <input class="form-control" type="text" placeholder="Licensee Address" disabled
                    [(ngModel)]="allSelectedLc[i].l_address_line_1">
                  <input class="form-control" type="text" placeholder="Licensee Address" disabled
                    [(ngModel)]="allSelectedLc[i].l_address_line_2">
                  <input class="form-control" type="text" placeholder="Licensee Address" disabled
                    [(ngModel)]="allSelectedLc[i].l_address_line_3">

                  <input class="form-control" type="number" placeholder="Licensee Pincode" disabled
                    [(ngModel)]="allSelectedLc[i].l_pincode">

                  <input class="form-control" type="text" placeholder="Licensee State" disabled
                    [(ngModel)]="allSelectedLc[i].l_state">
                  <input class="form-control" type="text" placeholder="Licensee City" disabled
                    [(ngModel)]="allSelectedLc[i].l_city">
                </div>
                <div *ngIf="allSelectedLc[i].cat_type==='bg'">
                  <input disabled class="form-control" type="text" placeholder="Additional Info / No Of Pax"
                    [(ngModel)]="allSelectedLc[i].event_extra">
                  <input disabled class="form-control" type="text" placeholder="Internal Notes"
                    [(ngModel)]="allSelectedLc[i].notes">
                </div>
                <!-- <div *ngIf="allSelectedLc[i].cartevidence?.length > 0">
                  <hr>
                  Selected Evidence : <br>
                  <div class="col-sm-12 mt-2" style="background: #f4f5f7;">
                    <table class="col-12 col-md-12 col-sm-12 " style="width: 100%;" border=1 cellpadding=3 cellspacing=3>
                    <tr>
                      <th class="text-center" style="width: 10%;">Sr. No.</th>
                      <th style="width: 90%;">File Name</th>
                    </tr>
                    <tr *ngFor="let evidence of allSelectedLc[i]?.cartevidence;let i =index;">
                      <td class="text-center">{{i+1}}</td>
                      <td><a href="{{evidence?.evidenceUrl}}" target="_blank">{{evidence?.filename}} </a></td>
                    </tr>
                    </table>
                    <br>
                  </div>
                </div> -->
                <br>
              </div>
              <!--<div class="col-2">
                    <input type="number" width=50px  class="form-control" min=1 placeholder="quantity" [(ngModel)]="allSelectedLc[i].quantity">
                  </div> -->
              <div class="col-3">
                <small>Q. : {{ allSelectedLc[i].quantity}} <br>
                  
                  {{slc.quantity * slc.no_of_usages * allSelectedLc[i].cattotal  * slc.usage_multiplier | number : '1.0-0'}}
                </small>
                <a (click)="cart_delete(i)" style="color: red">
                  <i class="ti-trash"></i>
                </a>

              </div>

            </div>
            <div class="centered-content" style="padding:10px">
              <h3>Total :  {{getQuoteTotal() | number : '1.0-0'}}</h3>
            </div>
          </div>


        </div>
        <hr>
        <div class=centered-content>
          <div class="btn-group mt-10 ">
            <!-- <button style="margin-right: 5px;" type="button" class="btn btn-primary btn-xl" previousStep><i
                class="ti-arrow-left"></i></button> -->
            <span> <button style="margin-right: 5px;" type="button" [hidden]="allSelectedLc.length<1"
                class="btn btn-primary btn-xl" (click)="saveQuotation()">Save Changes</button> &nbsp;</span>
            <button type="button" class="btn btn-primary btn-xl" [hidden]="allSelectedLc.length<1"
              (click)="saveQuotation(true)" nextStep>Buy Now</button>
          </div>
        </div>

      
    </wizard-step>
    <wizard-step stepTitle="Checkout">
      <div class="centered-content">


        <div class="row" *ngIf="selectedSlc">

          <div [class]="quotation.status==='pending' ? 'col-sm-12 col-xl-12' : 'col-sm-12 col-xl-12' ">
            <div *ngIf="selectedCustomer?.id > 0">
              <h4>Billing Summary</h4>
              <div class="btn-group mt-12 " *ngIf="quotation.pir_status=='approve' && quotation.is_old_tariff==0">
                <button *ngIf="quotation.pir_status=='approve' && quotation.noc == 0 " style="margin-right: 5px;"
                  type="button" class="btn btn-primary btn-sm" (click)="sendAlert('send-pi')"><i
                    class="cr-icon fa fa-envelope"></i> Send PI </button>
                <span *ngIf="quotation.pir_status=='approve'  && quotation.noc == 0"> <button style="margin-right: 5px;"
                    type="button" [hidden]="!quotation?.invoice_no" class="btn btn-primary btn-sm"
                    (click)="sendAlert('send-ti')"><i class="cr-icon fa fa-envelope"></i>
                    Send TI </button> &nbsp;</span>
                <button type="button" *ngIf="quotation.noc == 0 " class="btn btn-primary btn-sm"
                  [hidden]="quotation.license_issued!=1 && quotation.noc == 0" (click)="sendAlert('send-license')"><i
                    class="cr-icon fa fa-envelope"></i> Send Lic </button>
                <!-- <hr> -->
              </div>

              <hr>
              <!-- request for PI -->
              <!--quotation.user.role.id == 68 &&-->
              <!--[hidden]=true-->
              <!-- <div [hidden]=true *ngIf="quotation.status !='paid' &&  quotation.id && quotation.noc == 0" -->
                <div  *ngIf="quotation.status !='paid' && quotation.pir_status!='approve' && quotation.id && quotation.noc == 0"
                class="well well-sm" style="min-width: 273px;
              margin: 0px auto;">
                <a style="color:#FF7E00" class="" *ngIf="quotation.isPirChanged == 1 && quotation.pir_status"> PI
                  Changes are detected, Please send PI Request again. <br> </a>
                <a style="color:green" class="" *ngIf="quotation.pir_status=='pending'">PI Request Pending For
                  Approval</a>
                <a style="color:green;font-weight:bold" class="" *ngIf="quotation.pir_status=='approve'">PI Request is
                  Approved</a>
                <a style="color:red;font-weight:bold" class="" *ngIf="quotation.pir_status=='reject'">PI Request is
                  Rejected </a>
                <br>
                <button class="btn btn-primary btn-sm" (click)="commonService.openModal('modalpirequest')">Send PI For
                  Approval</button><br>

              </div>
              <!-- <hr> -->
              <!-- add new line container-->
              <ng-container *ngIf="quotation.pir_status=='approve' && quotation.noc == 0">
                <br>
                <p>License Fees :  {{getQuoteTotal()| number : '1.0-0'}} </p>
                <!-- persegst-->
                <span *ngIf="quotation?.multiinvoice">
                  <hr>
                  <span *ngFor="let item of quotation?.multiinvoice ; let i = index">
                    #{{i+1}} : GST : <b>{{item.gst}}</b> - <b>Rs. {{item.cartamountwithdiscount}}</b>
                    <br>({{item.totallicenses}} Licenses) | <span> <a target=_blank
                        href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}&invoice=1&mi={{i+1}}"><span
                          *ngIf="!quotation.invoice_no">Preview TI</span> Download</a></span><br>
                    <hr>
                  </span>
                  <hr>
                </span>
                <!-- endofpersegst-->

                <p *ngIf="discount>0">Current Applied Discount {{discount | number:'1.2-2'}}% : 
                  {{ getQuoteTotal() * discount/100 | number : '1.0-0'}} <br>
                  Total After Discount : 
                  {{ getQuoteTotal() - (getQuoteTotal() * previewdiscount/100)  | number : '1.0-0'}}
                </p>



                <div class="well well-sm" style="min-width: 273px;
                      margin: 0px auto;">

                  <span *ngIf="quotation.atir_status">
                    <a style="color:green" class="" *ngIf="quotation.atir_status=='pending'">Pending For Approval</a>
                    <a style="color:green;font-weight:bold" class="" *ngIf="quotation.atir_status=='approve'"
                      target=_blank href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}&invoice=1&uuid={{quotation.uuid}}">Advance Tax
                      Invoice
                      Request is Approved - Download</a>
                    <a style="color:red;font-weight:bold" class="" *ngIf="quotation.atir_status=='reject'">Advance Tax
                      Invoice Request is Rejected </a>
                    <br>
                  </span>
                  <button class="btn btn-primary btn-sm" *ngIf="quotation?.atir_status!='approve'"
                    (click)=" commonService.openModal('modalatirrequest')">Request For Advance Tax Invoice</button>

                </div>
                
                <hr>
                
                <div class="well well-sm" style="min-width: 273px;
                      margin: 0px auto;">
                  <div class="row" *ngIf="quotation.tag_name && quotation?.log_pitag.length > 1">    
                <div class="col-md-6">
                  <p style="color:black ;font-weight:bold"> Initial PI Tag</p>
                  <a style="color:green ;font-weight:bold" class="" *ngIf="quotation?.log_pitag[0]?.tag_name">Tag Name : {{quotation?.log_pitag[0]?.tag_name}}</a>
                  <br>
                  <a style="color:red;font-weight:bold" class="" *ngIf="quotation?.log_pitag[0]?.tag_remark">Remark : {{quotation?.log_pitag[0]?.tag_remark}}</a>
                  <br>
                  <a style="color:red;font-weight:bold" class="" *ngIf="quotation?.log_pitag[0]?.expected_date">Expected Date : {{quotation?.log_pitag[0]?.expected_date | date:'d/M/y'}} <br></a>

                  <a style="color:green ;font-weight:bold" class="" *ngIf="quotation?.log_pitag[0]?.tag_name">Created On : {{quotation?.log_pitag[0]?.created_on | date: 'd/M/y' }}<br></a>
                  <a style="color:green ;font-weight:bold" class="" *ngIf="quotation?.log_pitag[0]?.tag_name"> updated by : {{quotation?.log_pitag[0]?.tag_user_name }} <br></a>
                  <a style="color:green ;font-weight:bold" class="" *ngIf="quotation?.log_pitag[0]?.tag_name"> updated On : {{quotation?.log_pitag[0]?.created_on | date: 'd/M/y'}}<br></a>
                  <br>

                </div>

                  <div class="col-md-6" >
                    <p style="color:black ;font-weight:bold"> Current PI Tag</p>
                    <a style="color:green ;font-weight:bold" class="" *ngIf="quotation.tag_name">Tag Name : {{quotation.tag_name}}</a>
                    <br>
                    <a style="color:red;font-weight:bold" class="" *ngIf="quotation.tag_remark">Remark : {{quotation.tag_remark}}</a>
                    <br>
                    <a style="color:red;font-weight:bold" class="" *ngIf="quotation.tag_expected_date">Expected Date : {{quotation.tag_expected_date | date:'d/M/y'}} <br></a>

                    <a style="color:green ;font-weight:bold" class="" *ngIf="quotation.tag_name">Created On : {{quotation.tag_created_on | date: 'd/M/y' }}<br></a>
                    <a style="color:green ;font-weight:bold" class="" *ngIf="quotation.tag_name">Last updated by : {{quotation?.tag_user_id?.name }} <br></a>
                    <a style="color:green ;font-weight:bold" class="" *ngIf="quotation.tag_name">Last updated On : {{quotation.tag_updated_on | date: 'd/M/y'}}<br></a>
                    <br>
                  </div>
                </div>

                <span *ngIf="quotation.tag_name && quotation?.log_pitag.length == 1">
                  <p style="color:black ;font-weight:bold"> Initial PI Tag</p>
                  <a style="color:green ;font-weight:bold" class="" *ngIf="quotation.tag_name">Tag Name : {{quotation.tag_name}}</a>
                  <br>
                  <a style="color:red;font-weight:bold" class="" *ngIf="quotation.tag_remark">Remark : {{quotation.tag_remark}}</a>
                  <br>
                  <a style="color:red;font-weight:bold" class="" *ngIf="quotation.tag_expected_date">Expected Date : {{quotation.tag_expected_date | date:'d/M/y'}} <br></a>

                  <a style="color:green ;font-weight:bold" class="" *ngIf="quotation.tag_name">Created On : {{quotation.tag_created_on | date: 'd/M/y' }}<br></a>
                  <a style="color:green ;font-weight:bold" class="" *ngIf="quotation.tag_name">Last updated by : {{quotation?.tag_user_id?.name }} <br></a>
                  <a style="color:green ;font-weight:bold" class="" *ngIf="quotation.tag_name">Last updated On : {{quotation.tag_updated_on | date: 'd/M/y'}}<br></a>
                  <br>

                </span>

                  <button class="btn btn-primary btn-sm" (click)="showPi()"><b>Add PI Tag</b></button>

                </div>


                <hr>
                <div class="well well-sm" style="min-width: 273px;
                      margin: 0px auto;" *ngIf="getQuoteTotal()>minamountfordiscount ">

                  <span *ngIf="maxdiscount > 0">Apply Discount : <input style="width:50px" type=number min=0 max=101
                      [(ngModel)]="previewdiscount" (change)="validateMax($event,selectedUser.role.discount)"> % = 
                    {{ getQuoteTotal() * previewdiscount/100  | number : '1.0-0'}}
                    &nbsp;&nbsp; <button class="btn btn-secondary btn-sm" (click)="applyDiscount() ">Apply
                      Discount</button>
                    <hr *ngIf="quotation.dr_status"> </span>

                  <!-- <span *ngIf="quotation.dr_status=='pending' && previewdiscount > 99"> <a style="color:green;font-weight:bold;" class=""> NOC Request of Pending For Approval </a> <br></span> -->
                  <br>
                  <a style="color:green" class="" *ngIf="quotation.dr_status=='pending'">
                    <span *ngIf="quotation.dr_discount < 99">Discount Request of
                      {{quotation.dr_discount | number:'1.2-2'}}% </span>
                    <!-- <span *ngIf="quotation.dr_discount > 99">NOC Request is</span> -->
                    Pending For Approval</a>
                  <a style="color:green;font-weight:bold" class="" *ngIf="quotation.dr_status=='approve'">
                    <span *ngIf="quotation.dr_discount < 99">Discount Request of
                      {{quotation.dr_discount | number:'1.2-2'}}% </span>
                    <!-- <span *ngIf="quotation.dr_discount > 99">NOC Request </span> -->
                    is Approved</a>
                  <a style="color:red;font-weight:bold" class="" *ngIf="quotation.dr_status=='reject'">
                    <span *ngIf="quotation.dr_discount < 99">Discount Request of
                      {{quotation.dr_discount | number:'1.2-2'}}% </span>
                    <!-- <span *ngIf="quotation.dr_discount > 99">NOC Request </span>  -->
                    is Rejected</a>
                  <hr>

                  <button class="btn btn-primary btn-sm btn-sm"
                    (click)=" commonService.openModal('modaldrrequest'); quotation.dr_discount ='';">Request
                    For Discount</button>&nbsp;
                  <!-- <button class="btn btn-primary btn-sm " (click)=" commonService.openModal('modaldrrequest'); quotation.dr_discount =100;">Request
                      For NOC</button>
                      <br> -->




                </div>
              </ng-container>
              <!-- noc-->
              <ng-container *ngIf="quotation.pir_status=='approve' && quotation.noc == 1 ">
                <div class="well well-sm" style="min-width: 273px;margin: 0px auto;">
                  <a style="color:green;font-weight:bold" class=""
                    *ngIf="quotation.dr_status=='pending' && quotation.dr_discount > 99">
                    NOC Request is For Approval</a>
                  <a style="color:green;font-weight:bold" class=""
                    *ngIf="quotation.dr_status=='approve' && quotation.dr_discount > 99">
                    NOC Request is Approved</a>
                  <a style="color:red;font-weight:bold" class=""
                    *ngIf="quotation.dr_status=='reject' && quotation.dr_discount > 99">
                    NOC Request is Rejected </a>
                  <br>
                  <button class="btn btn-primary  "
                    (click)=" commonService.openModal('modaldrrequest'); quotation.dr_discount =100;">Request
                    For NOC</button>
                  <br>
                </div>
              </ng-container>

              <ng-container *ngIf ="(panstr && panstr == 'NOPAN') || (quotation.cpn_status==='approve')"> 
                <br>
                <div class="well well-sm" style="min-width: 273px;margin: 0px auto;">
                  <span *ngIf="quotation.cpn_status">
                    <a style="color:green" *ngIf="quotation.cpn_status=='pending'" class="">Customer NO PAN Request Pending For Approval</a>
                    <a style="color:green;font-weight:bold"  *ngIf="quotation.cpn_status=='approve'" class="">Customer PAN No Request Approved</a> 
                    <!-- &nbsp;&nbsp; <button *ngIf="quotation.cpn_status=='approve' && quotation.cpn_pan_no" class="btn btn-secondary btn-sm" (click)="applyCPN() ">Apply 
                      PAN Number</button>-->
                    <a style="color:red;font-weight:bold"*ngIf="quotation.cpn_status=='reject'">Customer PAN No Request is Rejected </a>
                    <br><br>
                  </span>
                  <button class="btn btn-primary btn-sm" (click)=" commonService.openModal('modalpanrequest'); cpnmodel();">Request For PAN No Change</button>
                </div>
              </ng-container>

              <!-- Interest UI start -->
              <!-- <ng-container  *ngIf="quotation.is_renewal_pi==1">
                <hr>
                <br>
                <h6>Interest Fee :  {{totalInterestf|  number:'1.2-2'}}</h6>
                <span style="color: #d34e47; margin-top:5px;margin-left:20px;">Note: *Interest is charged @18% per annum.</span>
                <br>
                <div class="col-12 col-md-12 col-sm-12 interestdiv" style="height: 200px; overflow-y: auto; 
                margin: 0px auto;">
                  <table class="col-12 col-md-12 col-sm-12  well well-sm " style="width: 100%;" border=5 cellpadding=4 cellspacing=3>
                    <tr>
                      <th style="width: 5%;">Sr.No.</th>
                      <th style="width: 40%;">Cart Id</th>
                      <th style="width: 20%;">no.of Days Delayed </th>
                      <th style="width: 35%;">Interest Fee </th>
                    </tr>
                    <tr *ngFor="let slc of allSelectedLc;let i = index">
                      <td>{{i+1}}</td>
                      <td>{{slc.cat_idcode}} : {{slc.name}} </td>
                      <td>
                          {{slc.latedays }}
                      </td>
                      <td>
                        {{slc.interesttotal | number:'1.2-2'}}
                    </td>
                    </tr>
                  </table>
                  <br>
              </div>
              <hr>
              </ng-container> -->
              <!-- Interest UI end  -->

              <ng-container *ngIf="quotation.pir_status=='approve' && quotation.noc == 0">
                <!-- <hr> -->
                <!--<p *ngIf="is_inmh()">GST :  {{  (getQuoteTotal() - (getQuoteTotal() * discount/100) ) * gst/100  | number : '1.0-0'}} </p>
                     <p *ngIf="!is_inmh()">
                        IGST (Other than Maharashtra) :  {{ (getQuoteTotal() 49- (getQuoteTotal() * discount/100) ) * igst/100 | number : '1.0-0'}}
                     </p>-->

                <div class="well well-sm" style="max-width: 273px;
                     margin: 0px auto;" *ngIf="selectedCustomer">
                  <div class="row">
                    <div class="col-3  " style="padding:5px">
                      TAN :
                    </div>
                    <div class="col-9">
                      <input type="text" class="form-control" name="tan"
                        (change)="field_validate($event,'tan',selectedCustomer?.tan)" placeholder="TAN"
                        [(ngModel)]="selectedCustomer.tan" required>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-3  " style="padding:5px">
                      TDS (%) :
                    </div>
                    <div class="col-9">
                      <input class="form-control " (change)="changeatds=true;checkIfTan($event); " type=number min=0
                        [(ngModel)]="tds">
                      <a *ngIf="changeatds" class="btn btn-primary btn-sm" style="color:white"
                        (click)="saveQuotation(true)">Apply TDS</a> <br>
                       {{  (getQuoteTotal() - (getQuoteTotal() * discount/100) ) * tds/100 | number : '1.0-0'}}
                    </div>

                  </div>

                  <!-- <span *ngIf="tanmms?.ldc_percent && this.selectedCustomer?.tan">
                    <hr>
                    <span style="font-weight:bold"> This TAN carries LDC @ {{tanmms?.ldc_percent}}% <br>
                      in the name of <b>{{tanmms?.ldc_name}}</b>
                      <br>
                      which is valid from {{tanmms?.ldc_startdate | date: 'd/M/y'}} to
                      {{tanmms?.ldc_enddate | date: 'd/M/y'}} 
                    </span>
                    <hr>
                  </span> -->
                  
                </div>

              </ng-container>
              <h3>
                <br>
                Total :
                 {{getQuoteFinalTotal() | number : '1.0-0'}}
              </h3>
              <!-- inerest calculation total show start -->
              <!-- <h4 *ngIf="quotation.is_renewal_pi==1">
                <br>
                Interest Fee :
                 {{getInterestTotal() | number : '1.0-0'}}
              </h4>
              <h4 *ngIf="quotation.is_renewal_pi==1">
                <br>
                All Total :
                 {{getQuoteFinalTotalWithInterest() | number : '1.0-0'}}
              </h4> -->
              <!--inerest calculation total end  -->
            </div>
            <!-- </div>

                <div *ngIf="quotation.status=='pending'" class="col-sm-6 col-xl-6"> 
                    <h3>Payment</h3>
                -->
            <hr>
            <ng-container *ngIf="quotation.pir_status=='approve' && quotation.noc == 0 && ((quotation.tax==12 && quotation.atir_status=='approve') || quotation.tax!=12 || quotation.status=='paid')">
              <ng-container *ngIf="quotation?.id">
                <div *ngIf="quotation?.id && quotation?.transactions.length>0" style="max-width:600px;margin:0px auto;"
                  class="centered-content">
                  <b>Previous Payments :</b><br>
                  <table style="margin:0px auto;max-width:273px;border:1px solid gray" border=1 cellpadding=3
                    cellspacing=3>
                    <tr>
                      <th>Id</th>
                      <th>Details</th>
                      <th></th>
                    </tr>
                    <tr *ngFor="let tr of quotation.transactions">
                      <td>#{{tr.id}}<br>
                        <span *ngIf="tr.receipt_no">{{tr?.receipt_no}} </span>
                      </td>
                      <td style="padding:3px">
                        <span *ngIf="tr.status!='success'" title="{{tr.status}}">
                          <i class=" ti-time"></i>
                           {{tr.amount}}
                        </span>

                        <span *ngIf="tr.status=='success'" style="color:green" title="{{tr.status}}">
                          <i class=" ti-check"></i>
                           {{tr.amount}}
                        </span> <br> <small>
                          <b>{{tr.payment_method}}</b> <br>
                          Ref No : {{tr.ref_no}} <br>
                          <span *ngIf="tr?.pickuppoint"> <br>
                            Pickup Point : {{tr.pickuppoint}}
                          </span>

                          <span *ngIf="tr.remark"> <br>
                            Remark : {{tr.remark}}
                          </span>
                        </small>
                      </td>


                      <td style="text-align:center">
                        <a style="color: #6B05F9" href="{{commonService.apiUrl}}/pg/receipt.php?id={{tr.id}}&uuid={{tr.uuid}}"
                          target=_blank>
                          Receipt</a> <Br>

                        <a *ngIf="tr.status=='pending'" style="color: blue" (click)="setst(tr)">
                          Edit</a>

                        &nbsp; &nbsp; <a *ngIf="tr.status=='pending'" style="color: red"
                          (click)="deleteTransaction(tr.id)">
                          Cancel</a>

                      </td>
                    </tr>
                  </table>
                  <hr>
                  <h4> Balance :  {{remainingPayment}} </h4>
                  <hr>
                </div>
              </ng-container>
              <div *ngIf="quotation.pir_status=='approve' && quotation.is_old_tariff==0 ">
                <span style="font-weight:bold;font-size:large"> Payment Method : </span>&nbsp;<Br>
                <label *ngIf="!quotation.transaction"><input (click)="resetst()" type=radio name=pmode
                    value="ONLINE_PG1" [(ngModel)]="selectedTransaction.payment_method"> Online </label> &nbsp;&nbsp;
                <label><input (click)="resetst()" type=radio name=pmode value="OFFLINE_NEFTIMPSRTGS"
                    [(ngModel)]="selectedTransaction.payment_method"> IMPS/NEFT/RTGS </label>&nbsp;&nbsp;
                <label><input (click)="resetst()" type=radio name=pmode value="OFFLINE_CHEQUEDD"
                    [(ngModel)]="selectedTransaction.payment_method"> Cheque/DD </label>
              </div>

              <div *ngIf="quotation.pir_status=='approve' && quotation.is_old_tariff==1 ">
                <span style="color:red;font-weight:bold" > To update the Tariff, Click on License Categories Page --> Add New Cart with updated Tariff and delete the Old Cart --> Click on Buy Now</span>
              </div>

              <div *ngIf="selectedTransaction?.payment_method=='ONLINE_PG1'">
                <div class="well well-sm" style="max-width: 273px;
    margin: 0px auto;">
                  Payment Link : <a href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}&uuid={{quotation.uuid}}"
                    target=_blank>{{commonService.apiUrl}}/pg/?id={{quotation.id}}&uuid={{quotation.uuid}} </a> <br>
                </div>
                <a *ngIf="quotation?.id && quotation?.status=='pending'" style="margin-right: 5px;"
                  (click)="saveQuotation(true);checkIfPaid();"
                  href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}&pay=111111&invoice=2&closeonsuccess=1&uuid={{quotation.uuid}}"
                  target=_blank class="btn btn-primary btn-xl">Pay Online Now</a>

              </div>

              <div
              *ngIf="selectedTransaction?.payment_method=='OFFLINE_NEFTIMPSRTGS' || selectedTransaction?.payment_method=='OFFLINE_CHEQUEDD'"
                style="width: 273px;
                     margin:0px auto;">
                <div class="row">
                  <div class="col-12">
                    <input class="form-control" name=ref_no [(ngModel)]=selectedTransaction.ref_no
                      [placeholder]="selectedTransaction.payment_method=='OFFLINE_CHEQUEDD' ? 'Cheque No/ DD no': 'UTR No.'">
                    <input type=date class="form-control" name=pdate [(ngModel)]=selectedTransaction.date
                      placeholder="Cheque/DD Date">
                    <input class="form-control" *ngIf="selectedTransaction?.payment_method=='OFFLINE_CHEQUEDD'" name=bank [(ngModel)]=selectedTransaction.bank
                      placeholder="Client's Bank Name">
                    <input class="form-control" *ngIf="selectedTransaction?.payment_method=='OFFLINE_CHEQUEDD'" name=branch [(ngModel)]=selectedTransaction.branch
                      placeholder="Client's Bank Branch">
                    <input type=number class="form-control" name=amount [(ngModel)]=selectedTransaction.amount
                      placeholder="Amount">
                    <br> <span style="text-align: left" *ngIf="selectedTransaction?.payment_method=='OFFLINE_CHEQUEDD'">
                      Cheque Collection/Pickup Location : *
                      <ng-select name=pickuppoint bindLabel="name" [items]="pickuplocations"
                        [loading]="pickuplocationLoading" [typeahead]="custTypeaheadPickuplocation"
                        placeholder="Search Pickup Location" bindValue="name"
                        [(ngModel)]=selectedTransaction.pickuppoint>
                      </ng-select>

                    </span>
                    <!--   <input class="form-control" name=pickuppoint [(ngModel)]=selectedTransaction.pickuppoint placeholder="Cheque Drop / Pickup Point">
                        -->
                    <br>
                                             <!-- <ng-select [(ngModel)]=selectedTransaction.pplbank placeholder="Select PPL Bank Account" [items]="['CITI','ICICI','SBI']"></ng-select> -->


                    <input type="text" class="form-control" name="remark" [(ngModel)]=selectedTransaction.remark
                      placeholder="Remark">
                    <br>
                    <button (click)="addEditTransaction()" class="btn btn-primary btn-xl">
                      Add <span *ngIf="selectedTransaction.id">/Edit</span> Transaction</button>




                  </div>
                </div>

              </div>
              <!--<a  class="btn btn-primary btn-xl" target=_blank href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}">Download Quotation</a> 
                    <a *ngIf="quotation.status=='pending'" (click)="saveQuotation(true)"  href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}&pay=111111" target=_blank class="btn btn-primary btn-xl"  >Pay Now</a>
                  -->
            </ng-container>
          </div>
        </div>

        <!-- </ng-container> -->
        <hr>
        <div class="btn-group mt-10 centered-content text-center">

          <div class=" centered-content text-center" style="padding-top:10px">
            <span *ngIf="quotation.atir_status!='pending' && quotation.atir_status!='approve' ">
              <!-- <button
                style="margin-right: 5px;" type="button" class="btn btn-primary btn-xl" previousStep><i
                  class="ti-arrow-left"></i> </button>  -->
                  &nbsp;
                </span>
            <a *ngIf="quotation?.id && quotation.pir_status=='approve'" class="btn btn-primary btn-xl" target=_blank
              href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}&invoice=2&uuid={{quotation.uuid}}">Download Proforma Invoice</a>
          </div>

          <!--  <span>  <button style="margin-right: 5px;" type="button" [hidden]="allSelectedLc.length<1" class="btn btn-secondary btn-xl" (click)="saveQuotation(true)">Save Changes</button> &nbsp;</span>
        
      
<span>          <button *ngIf="quotation.status=='draft'" type="button" class="btn btn-primary btn-xl" (click)="saveQuotation(true)">Buy Now</button></span>
  -->
        </div>
      </div>
    </wizard-step>
    <!--
    <wizard-step stepTitle="Payment" >
      <div class="centered-content">
        <div>
          <h3>Payment</h3>
          Payment Link :
          <div class="well well-sm">
                 <a href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}" target=_blank>{{commonService.apiUrl}}/pg/?id={{quotation.id}}</a> 
            </div>
            <a  class="btn btn-primary btn-xl" target=_blank href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}">Download Quotation</a> | <a *ngIf="quotation.status=='pending'"  href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}" target=_blank class="btn btn-danger btn-xl"  >Pay Now</a>

        </div>
<hr>
        <div class="btn-group mt-10">
          <button type="button" class="btn btn-secondary btn-xl" previousStep>Back</button>
          <button type="button" class="btn btn-primary btn-xl" nextStep>Done !</button> 
        </div>
      </div>
    </wizard-step> -->


    <!-- <wizard-step stepTitle="Finished">
      <div class="centered-content">
        <div>
          <h3>All Done !</h3>
          <p>Quotation ID #{{quotation.id}}</p>
        </div>

        <div class="btn-group mt-10">
           <button type="button" class="btn btn-danger btn-sm" resetWizard>View All Quotations</button>
        </div>
      </div>
    </wizard-step> -->
  <!-- </wizard> -->

  <!-- Customer NO PAN Approval -->
  <div *ngIf ="quotation.status =='paid' && commonService.getCurrentUser().role_id < 71 && ((panstr && panstr == 'NOPAN') || (quotation.cpn_status==='approve'))">
    
    
    <div class="row well well-sm">
      <ng-container > 
        
        <div style="min-width: 273px;margin: 0px auto;">
          <span *ngIf="quotation.cpn_status">
            <a style="color:green" *ngIf="quotation.cpn_status=='pending'" class="">Customer NO PAN Request Pending For Approval</a>
            <a style="color:green;font-weight:bold"  *ngIf="quotation.cpn_status=='approve'" class="">Customer PAN No Request Approved</a> 
            <a style="color:red;font-weight:bold"*ngIf="quotation.cpn_status=='reject'">Customer PAN No Request is Rejected </a>
            <br><br>
          </span>
          <button class="btn btn-primary btn-sm" (click)=" commonService.openModal('modalpanrequest'); cpnmodel();">Request For PAN No Change</button>
        </div>
      </ng-container>
    </div>
  </div>
 
  <!-- no pan close -->

  <!-- Add evidence functionality -->
  <!-- *ngIf="!showdr && authService.checkPermission(2)" -->
  <div *ngIf="(quotation.status !='daft' && !loading && quotation?.id)">
    <hr>
    <h5>Evidence Upload</h5>
    &nbsp;
    <div class="row">
      <div class="col-md-4">
        <div class="row">
          <h4 style="font-size: 15px;font-weight: 600;margin-top: 10px;margin-left:25px;">Evidence Upload : </h4>
          <div
            *ngIf="((quotation.status =='pending' && authService.checkPermission(81)) || (quotation.status =='paid' && authService.checkPermission(82)))"
            class="col-sm-6 col-12 col-md-6">
            <input type="file" class="form-control" name="photo_upload" placeholder="Select files"
              (change)="onFileChangeUploadEvidence($event)" accept=".png,.jpg,.jpeg,.mp3, .mpeg , .mp4, .webm, .wmv"
              multiple>
          </div>
          <br>
          <span style="color: #d34e47; margin-top:5px;margin-left:20px;">Note: File type supporting only png, jpg, jpeg,
            mp3, mp4, webm, wmv
          </span>
        </div>
        <div class="col-sm-12 col-12 row mx-auto " style="display: inline-block;" *ngIf="isloading">
          <div class="progress" style="margin-top: 10px;margin-bottom: 10px;">
            <div class="progress-bar progress-bar-striped" role="progressbar" [style.width.%]="imgprogress"
              attr.aria-valuenow="{{imgprogress}}" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>
        <br>
        <div *ngIf="allevidence.length > 0" class="col-12 col-md-12 col-sm-12 "
          style="height: 200px; overflow-y: auto;">
          <table class="col-12 col-md-12 col-sm-12 " style="width: 100%;" border=1 cellpadding=3 cellspacing=3>
            <tr>
              <th class="text-center" style="width: 10%;">Sr.No.</th>
              <th style="width: 80%;">File Name</th>
              <th
                *ngIf="((quotation.status =='pending' && authService.checkPermission(81)) || (quotation.status =='paid' && authService.checkPermission(82)))"
                class="text-center" style="width: 10%;">Action</th>
            </tr>
            <tr *ngFor="let tr of allevidence; let i = index">
              <td class="text-center">{{i+1}}</td>
              <td><a href="{{tr?.evidenceUrl}}" target="_blank">{{tr?.filename}} </a>
              </td>
              <td
                *ngIf="((quotation.status =='pending' && authService.checkPermission(81)) || (quotation.status =='paid' && authService.checkPermission(82)))"
                class="text-center"><a style="color: red" (click)="deleteEvidencefilePopup(tr, i)">
                  <i class="ti-trash"></i>
                </a></td>
            </tr>
          </table>
          <br>
        </div>

      </div>
      <div class="col-md-8">
        <h4 style="font-size: 15px;font-weight: 600;margin-top: 10px;margin-left:25px;">Select Evidence For Cart : </h4>
        <div class="col-12 col-md-12 col-sm-12" style="height: 250px; overflow-y: auto;">
          <table class="col-12 col-md-12 col-sm-12 " style="width: 100%;" border=1 cellpadding=4 cellspacing=3>
            <tr>
              <th class="text-center" style="width: 10%;">Sr.No.</th>
              <th style="width: 40%;">Cart Id</th>
              <th style="width: 40%;">Attached Evidence</th>
              <th
                *ngIf="((quotation.status =='pending' && authService.checkPermission(81)) || (quotation.status =='paid' && authService.checkPermission(82)))"
                class="text-center" style="width: 10%;">Action</th>
            </tr>
            <tr *ngFor="let slc of allSelectedLc;let i = index">
              <td class="text-center">{{i+1}}</td>
              <td>{{slc.cat_idcode}} : {{slc.name}} <br> <small> <b>customer :
                    {{slc?.l_name}}</b><br>{{slc?.l_address_line_1}} {{ slc?.l_city }} {{ slc?.l_pincode}} </small>
              </td>
              <td><span *ngFor="let evidence of slc?.cartevidence;"><a href="{{evidence?.evidenceUrl}}"
                    target="_blank">{{evidence?.filename}}</a><br></span></td>
              <td
                *ngIf="((quotation.status =='pending' && authService.checkPermission(81)) || (quotation.status =='paid' && authService.checkPermission(82)))"
                class="text-center">
                <div>
                  <button class="button " class="btn btn-info btn-sm"
                    (click)="modalevidence.show(); openmodalselectfile(i) "> Add Evidence</button>
                </div>
              </td>
            </tr>
          </table>
          <br>
        </div>
      </div>
    </div>
    <div
      *ngIf="((quotation.status =='pending' && authService.checkPermission(81)) || (quotation.status =='paid' && authService.checkPermission(82)))"
      class="d-flex justify-content-center mt-3">
      <button *ngIf="saveEvidanceBtn == true" class="btn btn-md centered-content text-center btn-primary"
        (click)="saveEvidence()"> Save Evidence</button>
    </div>
    <!-- [disabled] ="saveEvidanceBtn == false" -->

  </div>
  <!-- close -->
  <!-- receipt - transactions - return transactions-->
  <div *ngIf="quotation.status!='draft' && !loading && quotation?.id && quotation.noc == 0">
    <hr>
    <a *ngIf="authService.checkPermission(11)" style="color:white" class="btn btn-secondary btn-sm"
      (click)="selectedrTransaction.id=0;commonService.openModal('modaladdreturntransaction')">Refund Payment </a>
    &nbsp;
    <a *ngIf="authService.checkPermission(12)" style="color:white" class="btn btn-secondary btn-sm"
      (click)="confirmOpenCN()"> Create Credit Note</a>

    <div class="row">
      <div class="col-md-4" *ngIf="quotation?.transactions">
        <b>Receipts :</b><br>
        <table style="margin:0px auto;border:1px solid gray" border=1 cellpadding=3 cellspacing=3>
          <tr>
            <th>Id</th>
            <th>Details</th>
            <th></th>
          </tr>
          <tr *ngFor="let tr of quotation.transactions">
            <td>{{tr.id}} <br>
              <span *ngIf="tr.receipt_no">{{tr?.receipt_no}} </span>

            </td>
            <td style="padding:3px">
              <span *ngIf="tr.status!='success'" title="{{tr.status}}">
                <i class=" ti-time"></i>
                 {{tr.amount}}
              </span>

              <span *ngIf="tr.status=='success'" style="color:green" title="{{tr.status}}">
                <i class=" ti-check"></i>
                 {{tr.amount}}
              </span> <br> <small>
                <b>{{tr.payment_method}}</b> <br>
                Ref No : {{tr.ref_no}}
              </small>
            </td>


            <td style="text-align:center">
              <a style="color: #6B05F9" href="{{commonService.apiUrl}}/pg/receipt.php?id={{tr.id}}&uuid={{tr.uuid}}" target=_blank>
                Receipt</a> <Br>

              <a *ngIf="tr.status=='pending'" style="color: blue" (click)="setst(tr)">
                Edit</a>

              &nbsp; &nbsp; <a *ngIf="tr.status=='pending'" style="color: red" (click)="deleteTransaction(tr.id)">
                Delete</a>

            </td>
          </tr>
        </table>

        <span *ngIf="quotation?.status=='paid'">
          <hr> Balance :  {{remainingPayment}} </span>

      </div>
      <div class="col-md-4" *ngIf="quotation?.creditnotes">
        <b>Credit Notes:</b><br>
        <table style="margin:0px auto; border:1px solid gray" border=1 cellpadding=3 cellspacing=3>
          <tr>
            <th>Id</th>
            <th>Details</th>
            <th>Amount</th>
            <th></th>
          </tr>
          <tr *ngFor="let cn of quotation?.creditnotes">
            <td>{{cn.id}}</td>
            <td>{{cn.creditnote_no}}</td>
            <td>{{cn.amount}}</td>
            <td> <a style="color: #6B05F9" href="{{commonService.apiUrl}}/pg/creditnote.php?id={{cn.id}}" target=_blank>
                View</a> </td>
          </tr>
        </table>
      </div>


      <div class="col-md-4" *ngIf="quotation?.returntransactions">
        <b>Refunds :</b><br>
        <table style="margin:0px auto; border:1px solid gray" border=1 cellpadding=3 cellspacing=3>
          <tr>
            <th>Id</th>
            <th>Details</th>
            <th></th>
          </tr>
          <tr *ngFor="let tr of quotation?.returntransactions">
            <td>{{tr.id}}</td>
            <td style="padding:3px">
              <span *ngIf="tr.status!='success'" title="{{tr.status}}">
                <i class=" ti-time"></i>
                 {{tr.amount}}
              </span>

              <span *ngIf="tr.status=='success'" style="color:green" title="{{tr.status}}">
                <i class=" ti-check"></i>
                 {{tr.amount}}
              </span> <br> <small>
                <b>{{tr.payment_method}}</b> <br>
                Ref No : {{tr.ref_no}}
              </small>
            </td>


            <td style="text-align:center">
              <a style="color: #6B05F9" href="{{commonService.apiUrl}}/pg/returnreceipt.php?id={{tr.id}}" target=_blank>
                Payment Details</a> <Br>
              <a *ngIf="tr.status=='pending'" style="color: blue"
                (click)="setst(tr);commonService.showModal('modaladdreturntransaction')"> Edit</a>

            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <!-- end of return tr -->

<app-modal-basic #modalIssueLicenses [dialogClass]="'modal-lg'">
  <div class="app-modal-header">
    <h4 class="modal-title">Issue Licenses <small *ngIf="issuedLc.action=='cancel'" style="color:red">ALL LICENSES ARE
        CANCELLED</small></h4>
    <button type="button" class="close basic-close" (click)="modalIssueLicenses.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body" *ngIf="allSelectedLc && quotation.status=='paid' && !selectedSlc.id ">

    <div class="centered-contentt" *ngIf="allSelectedLc.length>0 " style="max-height:500px;overflow:scroll">

      <div class="row" *ngFor="let slc of allSelectedLc;let i = index" style="border: 1px solid #e4e4e4;
   padding: 10px;
   box-shadow: 1px 1px 1px gray;">
        <div class="col-sm-12 col-xl-1">
          {{i+1}}
        </div>
        <div class="col-sm-12 col-xl-5">
          <b> {{slc?.displayname}} </b> <br> <span *ngIf="slc.cat_type=='bg'">{{slc.ltype}} <br></span>
          <div *ngFor="let cf of slc.custom_fields">

            <span *ngIf="(cf.f_type=='single_field' || cf.f_type=='range_field'  ) && cf.setcartvalue">{{cf.f_name}} :
              {{cf.setcartvalue}} </span>
            <span *ngIf="cf.f_type!='single_field' &&  cf.f_type!='range_field' && cf.setcartvalue ">
              {{cf.name}} : {{getCfValue(cf)}}
              <span *ngIf="cf.setaddcartvalue && cf.setcartvalue.addfield_desc.length > 1"> <br>
                <i>{{cf.addfield_name}} : {{cf.setaddcartvalue}}</i>
              </span>
            </span>

          </div>

          <b>{{slc.no_of_usages_f_name}} </b>: {{allSelectedLc[i].no_of_usages}}
          <br>
          <hr>
          <span *ngIf="slc.cat_type=='bg' && issuedLc.slcs[i]"> Start Date :
            <small>{{slc.start_date | date: 'd/M/y'}}</small>
            <input type=date [disabled]="commonService.getCurrentUser().role.level > 1"
              [(ngModel)]=issuedLc.slcs[i].start_date class="form-control" name=start_date>
            <br> End Date :
            <small>{{slc.end_date | date: 'd/M/y'}}</small>
            <input type=date [disabled]="commonService.getCurrentUser().role.level > 1"
              [(ngModel)]=issuedLc.slcs[i].end_date class="form-control" name=end_date>
          </span>

        </div>
        <div class="col-sm-12 col-xl-6" *ngIf="quotation.id && quotation.status=='paid'  && issuedLc.slcs[i] ">

          <b>No Of Licenses : {{allSelectedLc[i].quantity}}</b>
          <hr>

          <div *ngFor="let x of ' '.repeat(issuedLc.slcs[i].quantity).split(''), let xx = index">
            #{{xx+1}} <a *ngIf="issuedLc.action==='save' && issuedLc.slcs[i]['cat_type']!='penalty'" class="btn btn-primary btn-sm" target=_blank
              href="{{commonService.apiUrl}}/lp/?id=2018/{{quotation.id}}/{{i+1}}/{{xx+1}}"> Preview</a>
            <a *ngIf="issuedLc.action==='issue' && issuedLc.slcs[i]['cat_type']!='penalty'" class="btn btn-primary btn-sm" target=_blank
              href="{{commonService.apiUrl}}/lp/?id=2018/{{quotation.id}}/{{i+1}}/{{xx+1}}"> View Online</a>

            <a *ngIf="issuedLc.action==='issue' && issuedLc.slcs[i]['cat_type']!='penalty'" class="btn btn-primary btn-sm" target=_blank
              href="{{commonService.apiUrl}}/lp/?id=2018/{{quotation.id}}/{{i+1}}/{{xx+1}}&download=1"> Download PDF</a>

            <span *ngIf="currentUser.role.level < 3 && issuedLc.slcs[i]['cat_type']!='penalty'">
              <a *ngIf="!issuedLc.slcs[i].issuedLc[xx].cancel_license"
                (click)="issuedLc.slcs[i].issuedLc[xx].cancel_license=true" class="btn btn-secondary btn-sm"
                style="color:white">Disable Validity</a>
              <a *ngIf="issuedLc.slcs[i].issuedLc[xx].cancel_license"
                (click)="issuedLc.slcs[i].issuedLc[xx].cancel_license=false" class="btn btn-secondary btn-sm"
                style="color:white">Enable Validity</a>
            </span>

            <input style="text-transform:uppercase" class="form-control" type="text" placeholder="Customer Name"
              [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].l_name"><br>
            <input style="text-transform:uppercase" class="form-control" type="text" placeholder="Customer Franchisee"
              [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].l_franchise"><br>

            <!--                     <input disabled  class="form-control" type="text" placeholder="Customer Address" [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].address"> <br> -->
            <input class="form-control" type="text" placeholder="Customer Address 1"
              [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].l_address_line_1"> <br>
            <input class="form-control" type="text" placeholder="Customer Address 2"
              [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].l_address_line_2"> <br>
            <input class="form-control" type="text" placeholder="Customer Address 3"
              [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].l_address_line_3"> <br>
            <input class="form-control" type="text" placeholder="Customer State"
              [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].l_state"> <br>
            <input class="form-control" type="text" placeholder="Customer City"
              [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].l_city"> <br>
            <input class="form-control" type="text" placeholder="Customer Pincode"
              [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].l_pincode"> <br>

            <div *ngIf="issuedLc.slcs[i].cat_type==='event'">
              <hr>
              <input class="form-control" type="text" placeholder="Event name/title"
                [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_name"> <br>
              <input class="form-control" type="text" placeholder="Event Type"
                [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_type"> <br>

              <input [disabled]="commonService.getCurrentUser().role.level > 1" class="form-control"
                type="datetime-local" placeholder="Event Start DateTime"
                [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_start_datetime">
              <input [hidden]="issuedLc.slcs[i].hideeventenddate==1"
                [disabled]="commonService.getCurrentUser().role.level > 1" class="form-control" type="datetime-local"
                placeholder="Event End DateTime" [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_end_datetime"> <br>
              <input class="form-control" type="text" placeholder="Event Venue Name"
                [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_venue"> <br>
              <!--        <input  class="form-control" type="text" placeholder="Venue Location" [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_location"> <br>
                          <input  class="form-control" type="number" placeholder="Venue Pincode" [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_pincode"> <br>-->

              <input class="form-control" type="text" placeholder="Event State"
                [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_state"> <br>
              <input class="form-control" type="text" placeholder="Event City"
                [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_city"> <br>

              <input class="form-control" type="text" placeholder="Additional Info / No Of Pax"
                [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].event_extra"> <br>

            </div>
            <textarea class="form-control" placeholder="Internal Notes"
              [(ngModel)]="issuedLc.slcs[i].issuedLc[xx].notes"></textarea>

            <hr>
          </div>
        </div>
      </div>
    </div>
    <div
      *ngIf="(issuedLc.action!='issue' && issuedLc.action!='cancel') || commonService.getCurrentUser().role.level < 2"
      class="centered-content" style="text-align:center"> <button (click)="saveQuotationIssuedLc('save')" type="button"
        class="btn btn-primary waves-effect">Save Changes</button> | <button (click)="saveQuotationIssuedLc('issue')"
        type="button" class="btn btn-danger waves-effect">Issue Licenses</button></div>
    <div class=" centered-content" style="text-align:center" *ngIf="issuedLc.action=='issue'">
      <hr>
      <a href="{{commonService.apiUrl}}/pg/?id={{quotation.id}}&invoice=2&showlicense=1&uuid={{quotation.uuid}}" target=_blank>Download all
        Licenses</a>
      | <a style="cursor:pointer" *ngIf="commonService.getCurrentUser().role.level < 2"
        (click)="saveQuotationIssuedLc('cancel')">Cancel all Licenses</a>
    </div>
  </div>
</app-modal-basic>

<app-modal-animation #modaldrrequest [modalID]="'modaldrrequest'" [modalClass]="'modaldrrequest'">
  <div class="app-modal-header">
    <h4 class="modal-title" *ngIf="quotation.dr_discount < 99"> Request For Discount </h4>
    <h4 class="modal-title" *ngIf="quotation.dr_discount > 99 && quotation.extended_pi == 0"> Request For NOC </h4>
    <h4 class="modal-title" *ngIf="quotation.dr_discount > 99 && quotation.extended_pi == 1"> Request For Extended NOC </h4>
    <button type="button" class="close basic-close" (click)="commonService.hideModal('modaldrrequest')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <!-- *ngIf="selectedUser?.approver_user"  ,,,,*ngIf="quotation.dr_discount < 99"-->
    <span *ngIf="quotation.noc == 0" style="font-weight:bold"> {{quotation?.user?.name}}'s Discount Approver
      : {{quotation?.user?.reporting_user?.name}}
      <hr></span>
    <span *ngIf="quotation.dr_discount > 99 && quotation.noc == 1 && quotation.extended_pi == 0" style="font-weight:bold"> {{quotation?.user?.name}}'s
      NOC Approver
      : {{quotation?.user?.reporting_user?.name}}
      <hr></span>

      <!-- Extended noc covid impact -->
      <span *ngIf="quotation.dr_discount > 99 && quotation.noc == 1 && quotation.extended_pi == 1 " style="font-weight:bold"> {{quotation?.user?.name}}'s
        Extended NOC Approver
        : CHANDNI RAJESH PARIKH
        <hr></span>
        <!--close  -->

    <span *ngIf="quotation.dr_discount < 99"> Request Discount : <input type=number max=100 class="form-control"
        [(ngModel)]="quotation.dr_discount" placeholder="discount in %">
      <br>
    </span>
    <!-- <span *ngIf="quotation.dr_discount == 100" style="color:green;font-weight:bold;" class=""> <br>100 % discount is 
       considered for NOC <br> </span><br> -->
    <span *ngIf="quotation.dr_discount < 99">Reason For Discount :</span>
    <span *ngIf="quotation.dr_discount > 99 && quotation.extended_pi == 0">Reason For NOC :</span>
    <span *ngIf="quotation.dr_discount > 99 && quotation.extended_pi == 1">Reason For Extended NOC :</span>
    <textarea class="form-control" [(ngModel)]="quotation.dr_comment"
      [placeholder]=" quotation.dr_discount < 99 ? 'Reason for discount' : 'Reason for NOC'"></textarea>
    <hr>
    <button class="btn btn-primary " style="color:white" (click)="dr_request()"> Raise Request </button>
    <br> </div>
</app-modal-animation>

<app-modal-animation #modalatirrequest [modalID]="'modalatirrequest'" [modalClass]="'modalatirrequest'">
  <div class="app-modal-header">
    <h4 class="modal-title">Request For Advance Tax Invoice</h4>
    <button type="button" class="close basic-close" (click)="commonService.hideModal('modalatirrequest')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <!-- *ngIf="selectedUser?.approver_user"-->
    <span *ngIf="quotation?.user?.role_id < 72 || (quotation?.user?.role_id > 71 && quotation?.user?.role_id ==78)" style="font-weight:bold"> {{quotation?.user?.name}}'s ATI Approver :
      {{quotation?.user?.reporting_user?.name}}
      <hr></span>
      <span *ngIf="quotation?.user?.role_id > 71 && quotation?.user?.role_id !=78" style="font-weight:bold"> {{quotation?.user?.name}}'s ATI Approver :
        {{quotation?.user?.atiapprover_user?.name}}
        <hr></span>

    Schedule Payment Date : <input type=date class="form-control" [(ngModel)]="quotation.atir_scheduledate"
      placeholder="Payment Schedule Date"> <br>
    Reason For Same : <textarea class="form-control" [(ngModel)]="quotation.atir_comment"
      placeholder="Reason for Advance Tax Invoice"></textarea>
    <hr>
    <button class="btn btn-primary " style="color:white" (click)="atir_request()"> Raise Request </button>
    <br> </div>
</app-modal-animation>

<!-- PI TAg Start-->
<app-modal-animation #modalpitag [modalID]="'modalpitag'" [modalClass]="'modalpitag'">
  <div class="app-modal-header">
    <h4 class="modal-title">PI TAG</h4>
    <button type="button" class="close basic-close" (click)=" this.commonService.hideModal('modalpitag');">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <span> Select PI Tag: <ng-select bindLabel="name" [items]="tagpi" 
       placeholder="Select PI tag" bindValue="name"
      [(ngModel)]="tempitag.tag_name" required>
    </ng-select> </span>
    <br>
    
  <span *ngIf="tempitag.tag_name=='WILL PAY'">Expected Date : <input type=date class="form-control" [(ngModel)]="tempitag.tag_expected_date"
      placeholder="Payment Schedule Date"> <br></span>
    <span>Remark : <textarea class="form-control" [(ngModel)]="tempitag.tag_remark"
      placeholder="Remark"></textarea></span>
    <hr>
    <button class="btn btn-primary " style="color:white" (click)="pitag_request()"> Save </button>
    <br> </div>
</app-modal-animation>

<!-- Request PI  -->
<app-modal-animation #modalpirequest [modalID]="'modalpirequest'" [modalClass]="'modalpirequest'">
  <div class="app-modal-header">
    <h4 class="modal-title">Request For Proforma Invoice</h4>
    <button type="button" class="close basic-close" (click)="commonService.hideModal('modalpirequest')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <div class="btn-group col-12 col-md-12">
      <span *ngIf="quotation?.user?.role_id < 72 ||(quotation?.user?.role_id > 71 && quotation?.user?.role_id == 78)" style="font-weight:bold"> {{quotation?.user?.name}}'s Regional Manager :
        {{quotation?.user?.regional_user?.name}}
        <hr></span>
        <span *ngIf="quotation?.user?.role_id > 71 && quotation?.user?.role_id!=78" style="font-weight:bold"> {{quotation?.user?.name}}'s PI Approver :DEBASMITA PATRA
          
          <hr></span>
        <textarea class="form-control" [(ngModel)]="quotation.pir_comment"
      placeholder="Reason for PI Request"></textarea>
      <hr>
      <button class="btn btn-secondary float-right col-md-4 " style="color:white"
        (click)="commonService.hideModal('modalpirequest')"> Cancel Request </button>
      <button class="btn btn-primary float-left col-md-4" style="color:white" (click)="pir_request()"> Raise Request
      </button>

    </div>
    <br>
  </div>
</app-modal-animation>


<app-modal-animation #modaladdreturntransaction [modalID]="'modaladdreturntransaction'"
  [modalClass]="'modaladdreturntransaction'">
  <div class="app-modal-header">
    <h4 class="modal-title">Add Refund Transaction</h4>
    <button type="button" class="close basic-close" (click)="commonService.hideModal('modaladdreturntransaction')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <!-- <select class="form-control" placeholder="Select Remark" [(ngModel)]=selectedTransaction.remark >
          <ng-container *ngIf="selectedTransaction.payment_method=='REFUND'">
          <option>Cancellation of Event</option>
          <option>Event Rescheduled</option>
            <option>Wrong calculations of Fees</option>
              <option>Number of Licenses are reduced</option>    
            </ng-container>
            <ng-container *ngIf="selectedTransaction.payment_method=='EXCESSREFUND'">
              <option>Client paid extra, asking for refund</option>   
                </ng-container> 

        </select> -->
    <label><input (click)="resetst()" type=radio name=pmoder value="OFFLINE_NEFTIMPSRTGS"
        [(ngModel)]="selectedrTransaction.payment_method"> IMPS/NEFT/RTGS </label>&nbsp;&nbsp;
    <label><input (click)="resetst()" type=radio name=pmoder value="OFFLINE_CHEQUEDD"
        [(ngModel)]="selectedrTransaction.payment_method"> Cheque/DD </label>

    <input class="form-control" name=ref_no [(ngModel)]=selectedrTransaction.ref_no
      [placeholder]="selectedrTransaction.payment_method=='OFFLINE_CHEQUEDD' ? 'Cheque No/ DD no': 'UTR No.'">
    <input type=date class="form-control" name=pdate [(ngModel)]=selectedTransaction.date placeholder=" Date">
    <input class="form-control" name=bank [(ngModel)]=selectedrTransaction.bank placeholder="Bank Name">
    <input class="form-control" name=branch [(ngModel)]=selectedrTransaction.branch placeholder="Bank Branch">
    <input type=number class="form-control" name=amount [(ngModel)]=selectedrTransaction.amount placeholder="Amount">
    <br>
    <input type="text" class="form-control" name="remark" [(ngModel)]=selectedrTransaction.remark placeholder="Remark">

    <hr>
    <button (click)="addEditReturnTransaction()" class="btn btn-primary btn-xl">
      Add Transaction</button>

    <br> </div>
</app-modal-animation>


<app-modal-animation #modalcreditnote [modalID]="'modalcreditnote'" [modalClass]="'modalcreditnote'">
  <div class="app-modal-header">
    <h4 class="modal-title">Create Credit Note</h4>
    <p style="color:red;font-weight:bold">NOTE : Once Created , CN can not be Cancelled</p>
    <button type="button" class="close basic-close f-right" (click)="commonService.hideModal('modalcreditnote')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body" *ngIf="quotation">
    <!--  <ng-container *ngIf="quotation?.issuedlcjson?.length < 2">
            No Licenses Issued , If You Still Create Credit Note - It will be Full Reversal of This PI.
        </ng-container> -->
    <!--*ngIf="quotation?.issuedlcjson?.length > 4"-->
    <div *ngIf="quotation?.multiinvoice">
      <ng-select [items]=quotation?.multiinvoice placeholder="Select GST (For multiInvoice case)" bindLabel="gst"
        bindValue=gst [(ngModel)]="tempmodel.selectedGst"></ng-select>
    </div>
    <ng-container>
      <div style="max-height:500px;overflow:scroll">
        <table style="width:100%" cellspacing=2 cellpadding=2>
          <tr>
            <td></td>
            <td>Sr</td>
            <td>Q.</td>
            <td>CatId</td>
            <td>Total</td>
            <td>Remark</td>
          </tr>
          <ng-container *ngFor="let slc of issuedLc.slcs;let i = index">
            <!--  *ngFor="let x of ' '.repeat(allSelectedLc[i].quantity).split(''), let j = index"-->
            <tr *ngIf="(!quotation?.multiinvoice || (tempmodel.selectedGst==slc.mi_gst) ) ">
              <td><input type="checkbox" name="cnc[]" [(ngModel)]="issuedLc.slcs[i].cancel_license"
                  [disabled]="issuedLc.slcs[i].cancel_license"> </td>
              <td>{{i+1}}</td>
              <td>{{slc.quantity}}</td>
              <td>{{slc.cat_idcode}} <br> <small> <b>{{slc?.l_name}}</b><br>{{slc?.l_address}} </small></td>
              <td>Rs. <input class=form-control disabled [(ngModel)]="issuedLc.slcs[i].cn_amount"
                  [value]=getCatTotalFF(issuedLc.slcs[i])></td>
              <td>
                <select class="form-control" name=remark placeholder="Select Remark"
                  [(ngModel)]=issuedLc.slcs[i].cn_remark>
                  <ng-container>
                    <option value="Cancellation of Event">Cancellation of Event</option>
                    <option value="Event Rescheduled">Event Rescheduled</option>
                    <option value="Wrong calculations of Fees">Wrong calculations of Fees</option>
                    <option value="Number of Licenses are reduced">Number of Licenses are reduced</option>
                  </ng-container>


                </select>
              </td>
            </tr>
          </ng-container>

        </table>
      </div>
      <br>
      <div>
        <textarea class="form-control" [(ngModel)]="tempmodel.description" placeholder="Description" required></textarea>
      </div>
    </ng-container>

    <hr>



    <button (click)="createCreditNote()" class="btn btn-primary btn-xl f-right">
      Create Credit Note</button>
    &nbsp; &nbsp; &nbsp;
    <button class="btn btn-secondary btn-xl f-right" (click)="commonService.hideModal('modalcreditnote')">
      Cancel</button>

    <br>
  </div>
</app-modal-animation>

<!-- Select Evidence  -->


<app-modal-basic #modalevidence [dialogClass]="'modal-lg'">
  <div class="app-modal-header">
    <h4 class="modal-title">Select Evidence</h4>
    <button type="button" class="close basic-close" (click)="cancelmodel(); modalevidence.hide();">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <div *ngIf="tempallevidence.length <1">
      <span style="color: #d34e47;">All Files are used, Kindly add new file.</span>
    </div>
    <div *ngIf="tempallevidence.length >0" class="centered-contentt" style="max-height:500px;overflow-y: auto;">
      <table style="max-width:100%;width:100%" border=1 cellpadding=5 cellspacing=5>
        <tr>
          <th style="width: 10%;">Sr. No.</th>
          <th style="width: 90%;">File Name</th>
        </tr>
        <ng-container *ngFor="let tr of tempallevidence; let i = index">
          <tr>
            <td class="text-center"><span><input type="checkbox" name="checkbox" [(ngModel)]="tr.checked"
                  checked="true"></span></td>
            <td><span><a href="{{tr?.evidenceUrl}}" target="_blank">{{tr?.filename}}</a></span></td>
          </tr>
        </ng-container>
      </table>
      <br>&nbsp;
    </div>
    <br>
    <br>
    <div>
      <button class="btn btn-secondary float-left btn-sm " style="color:white"
        (click)="cancelmodel(); modalevidence.hide()">
        Cancel</button>

      <button *ngIf="tempallevidence.length >0" class="btn btn-primary float-right btn-sm" style="color:white"
        (click)="Addevidencetocart(); modalevidence.hide()">
        Add &nbsp; </button>
    </div>
  </div>
</app-modal-basic>

<app-modal-animation #modalpanrequest [modalID]="'modalpanrequest'" [modalClass]="'modalpanrequest'">
  <div class="app-modal-header">
    <h4 class="modal-title">Request For Change PAN No</h4>
    <button type="button" class="close basic-close" (click)="commonService.hideModal('modalpanrequest')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <!-- *ngIf="selectedUser?.approver_user"-->
    <span style="font-weight:bold"> {{quotation?.user?.name}}'s PAN No Approver :
      CHANDNI RAJESH PARIKH
      <hr></span>

    <div class="checkbox-fade fade-in-primary -d">
      <label><input type=checkbox name="cpn_flag" [checked]="show" (change)="shownopandiv()">
        <span class="cr"><i class="cr-icon fa fa-check txt-primary"></i></span>
        <span style="font-size: 15px;font-weight: 600;">Do you want to Use Default PAN No 'i.e. NOPAN1234Z'</span>
      </label>

    </div>
    <br><br>

    <div *ngIf="!show" id="divshow">
      PAN No: <input  type="text" class="form-control " name="cpn_pan_no" placeholder="Enter PAN"
        [(ngModel)]="quotation.cpn_pan_no" > <br>
        <!-- (change)="cpn_validate($event)" -->
    </div>

    Reason For Same : <textarea class="form-control" [(ngModel)]="quotation.cpn_comment"
      placeholder="Reason for Advance Tax Invoice"></textarea>
    <hr>
    <button class="btn btn-primary " style="color:white" (click)="cpn_request()"> Raise Request </button>
    <br>
  </div>
</app-modal-animation>


<!-- Rejected CART Items -->

<app-modal-basic #modalrejectcart [dialogClass]="'modal-lg'">
  <div class="app-modal-header">
    <h4 class="modal-title">Rejected Cart Items</h4>
    <button type="button" class="close basic-close" (click)="cancelmodel(); modalrejectcart.hide();">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <!-- <div *ngIf="tempallevidence.length <1">
      <span style="color: #d34e47;">All Files are used, Kindly add new file.</span>
    </div> -->
    <div *ngIf="rejectedArray.length >0" class="centered-contentt" style="max-height:500px;overflow-y: auto;">
      <table style="max-width:100%;width:100%" border=1 cellpadding=5 cellspacing=5>
        <tr>
          <th style="width: 50%;">Customer Name</th>
          <th>Error</th>
        </tr>
        <ng-container *ngFor="let tr of rejectedArray; let i = index">
          <tr>
            
            <td><span> {{tr?.l_name}}</span></td>
            <td *ngIf="tr.error"><span> {{tr?.error}}</span></td>
            <td *ngIf="!tr.error"><span> special characters Error</span></td>
          </tr>
        </ng-container>
      </table>
      <br>&nbsp;
    </div>
    <br>
    <br>
    <div>
      <button class="btn btn-secondary float-left btn-sm " style="color:white"
        (click)="cancelmodel(); modalrejectcart.hide()">
        Cancel</button>

      <button *ngIf="tempallevidence.length >0" class="btn btn-primary float-right btn-sm" style="color:white"
        (click)="Addevidencetocart(); modalrejectcart.hide()">
        Add &nbsp; </button>
    </div>
  </div>
</app-modal-basic>

<app-modal-animation #modalapirstrict [modalID]="'modalapirstrict'" [modalClass]="'modalapirstrict'">
  <div class="app-modal-header">
    <h4 class="modal-title">Note : GST Update 18%</h4>
    <button type="button" class="close basic-close" (click)="commonService.hideModal('modalapirstrict')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="app-modal-body">
    <div class="btn-group col-12 col-md-12">
      <span style="font-weight:bold"> Due to GST Revision from 12% to 18% you need to update PI.
        Kindly Contact ADMIN
        <hr></span> 
        <p>Step for update GST 18% :</p>
        <p>Go to License Category page => Just Click on Buy Button. </p>       
        
      <hr>
      <button class="btn btn-secondary float-right col-md-4 " style="color:white"
        (click)="commonService.hideModal('modalapirstrict')"> Close </button>
      


    </div>
    <br>
  </div>
</app-modal-animation>
