<div class="page-body">
  <div class="row">
  <div class="col-sm-12">

    <app-card >
     <!-- <span class="code-header">use class <code>data-table </code> with ngx-datatable and set <code>search element</code>.</span>-->
      <div class="row">

          <div class="col-md-4">
            <span class=" f-left" *ngIf=" commonService.getCurrentUser().role_id === '75' || commonService.getCurrentUser().role.level < 2">
              <label style="display:inline" for="upload2" *ngIf="authService.checkPermission(21)">

                  <span class="btn btn-info">Upload Statement</span>
                       <input type="file" id="upload2" style="display:none"  accept=".csv"   (change)="onFileChange($event)">
                        </label>
                        &nbsp;  <button *ngIf="authService.checkPermission(23)" class="btn btn-primary " (click)="runReco()">Run Reco</button>

                      </span>

                       </div>


                       <div class="col-md-4" style="margin: 10px 0px;">

                          <span  style="padding:10px">
                            Filter : <label> <input type=radio name="lcatfilter" checked (change)="filterq('all')"> All</label> &nbsp;&nbsp; <label> <input (change)="filterq('1')" type=radio name="lcatfilter"> Reco Done</label> &nbsp;&nbsp; <label> <input (change)="filterq('0')" type=radio name="lcatfilter"> Pending</label>

                          </span>
                        </div>

                         <div class="col-md-4">
                            <div class="input-group f-right"  >
                                <input type="search" autocomplete="off" [readonly]=!roflag
                                (focus)="roflag=true;"  (change)="search()" [(ngModel)]="searchq"  class="form-control"  placeholder="Search By id / Ref no ">
                              <span class="input-group-append "><i class="ti-search input-group-text"></i></span>
                            </div>

                         </div>



      </div>

      <div class="preloader3 loader-block" *ngIf="loading">
        <div class="circ1"></div>
        <div class="circ2"></div>
        <div class="circ3"></div>
        <div class="circ4"></div>
      </div>
      <ngx-datatable  *ngIf="!loadingIndicator"
      #table
      class="bootstrap"
      [columnMode]="'flex'"
      [headerHeight]="50"
      [footerHeight]="50"
      [rowHeight]="'auto'"
      [externalPaging]="true"
      [scrollbarH]="true"
      [count]="page.count"
      [offset]="page.offset"
      [limit]="page.limit"
      [rows]='tabrows'
      (page)="pageCallback($event)">
        <ngx-datatable-column name="Id" [flexGrow]="0.5" [minWidth]="147">
          <ng-template let-value="value" ngx-datatable-cell-template>
            {{value}}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Cust Ref/Narration" [flexGrow]="2" [minWidth]="588">
          <ng-template let-row="row"  let-value="value" ngx-datatable-cell-template>
   <b>{{row.custref_no}} </b> <br>
   {{row.narrative}}

      <br>
      <span title="Pickup Point" *ngIf="row.pickuppoint">PP  : {{row?.pickuppoint}}</span>
      <br>
      <small> Value Date : {{ row?.value_date | date: 'd/M/y' }} </small> | <small> Statement Date : {{ row?.statement_date | date: 'd/M/y' }} </small>
<br>
    <small> Created On : {{ row.created_on | date: 'd/M/y H:m' }} by {{row?.user?.name}}</small>
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column name="Details" [flexGrow]="1.5" [minWidth]="441">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>


              <span *ngIf="row.recodone!='1'"  >
                  <i  class=" ti-time"></i>
                  ₹ {{row.amount}}
                </span>

              <span *ngIf="row.recodone=='1'" style="color:green"   >
                <i  class=" ti-check"></i>
                ₹ {{row.amount}}
              </span>
              <br>
           <a  style="color: #6B05F9"  *ngIf="row?.transaction?.id && row.is_refund==0"
            href="{{commonService.apiUrl}}/pg/receipt.php?id={{row?.transaction?.id}}&uuid={{row?.transaction?.uuid}}" target=_blank   >
            Receipt #{{row?.transaction?.id}}</a>

            <a  style="color: #6B05F9"  *ngIf="row?.transaction?.id && row.is_refund==1"
            href="{{commonService.apiUrl}}/pg/returnreceipt.php?id={{row?.transaction?.id}}" target=_blank   >
            Return Receipt #{{row?.transaction?.id}}</a>

             <a  style="color: #6B05F9"  *ngIf="row?.transaction?.quotation_id"
            href="{{commonService.apiUrl}}/pg/?id={{row?.transaction?.quotation_id}}&invoice=2&uuid={{row?.transaction?.quotation_uuid}}" target=_blank   > | PI #{{row?.transaction?.quotation_id}}</a>
            <br>
          <span *ngIf="row?.transaction?.quotation_id">  ₹ {{row?.transaction?.amount}}<br>
             {{row?.transaction?.ref_no}}</span>
             
             <span *ngIf="row.pplbank" style="font-weight:bold"><br>PPL Bank Acc : {{row.pplbank}}</span>

          </ng-template>
        </ngx-datatable-column> 

        <ngx-datatable-column name="Amount" [flexGrow]="1.5">
          <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>

          </ng-template>
        </ngx-datatable-column>
         <ngx-datatable-column name="Action" [flexGrow]="0.5" [minWidth]="147">
          <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
          <a  style="color:white" class="btn btn-sm btn-primary"
           (click)="deleteBankstatement(row)" *ngIf="!row.deleted && row.recodone!='1' && authService.checkPermission(22)">Delete</a>

          <span style="color:red; font-weight:bold;" *ngIf="row?.deleted">Deleted</span>
          </ng-template>


        </ngx-datatable-column>
      </ngx-datatable>


    </app-card>
  </div>
</div>
</div> 



